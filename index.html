<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éê„Éâ„Éü„É≥„Éà„É≥Â§ß‰ºö Âá∫Â†¥ËÄÖÁôªÈå≤„Ç∑„Çπ„ÉÜ„É† - Phase 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
        }

        .form-section h3::before {
            content: "üìù";
            margin-right: 8px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group label .required {
            color: #dc3545;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .category-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .category-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .category-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .category-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .entry-group {
            background: #ffffff;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .entry-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .pair-section {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .pair-section h5 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #218838;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow-x: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .school-suggestions {
            position: absolute;
            background: white;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            width: calc(100% - 4px);
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .school-suggestion-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #e9ecef;
        }

        .school-suggestion-item:hover {
            background: #f8f9ff;
            color: #667eea;
            font-weight: 600;
        }

        .admin-section {
            background: #fff3cd;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #ffc107;
        }

        .admin-section h3 {
            color: #856404;
            margin-bottom: 20px;
        }

        .password-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .password-input input {
            flex: 1;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .config-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header h1 {
                font-size: 22px;
            }

            .tab {
                font-size: 12px;
                padding: 10px 5px;
            }

            .tab-content {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .category-selection {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∏ „Éê„Éâ„Éü„É≥„Éà„É≥Â§ß‰ºö Âá∫Â†¥ËÄÖÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†</h1>
            <p>Phase 1ÔºöÂá∫Â†¥ËÄÖ‰∏ÄÊã¨ÁôªÈå≤„ÉªÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">üìù Âá∫Â†¥ËÄÖÁôªÈå≤</div>
            <div class="tab" onclick="switchTab(1)">üìä ÁôªÈå≤Áä∂Ê≥Å</div>
            <div class="tab" onclick="switchTab(2)">‚öôÔ∏è ÁÆ°ÁêÜ„ÉªÂá∫Âäõ</div>
        </div>

        <!-- „Çø„Éñ1: Âá∫Â†¥ËÄÖÁôªÈå≤ -->
        <div class="tab-content active">
            <div id="alertMessage" class="alert"></div>

            <!-- Â≠¶Ê†°ÊÉÖÂ†± -->
            <div class="form-section">
                <h3>Â≠¶Ê†°ÊÉÖÂ†±„Éª‰ª£Ë°®ËÄÖÊÉÖÂ†±</h3>
                
                <div class="form-group">
                    <label>Â≠¶Ê†°Âêç<span class="required">*</span></label>
                    <input type="text" id="schoolName" name="schoolName" placeholder="‰æã: Êú≠ÂπåÂåóÈ´òÊ†°" autocomplete="off">
                    <div id="schoolSuggestions" class="school-suggestions hidden"></div>
                </div>

                <div class="form-group">
                    <label>‰ΩèÊâÄ</label>
                    <input type="text" id="address" name="address" placeholder="‰æã: ÂåóÊµ∑ÈÅìÊú≠ÂπåÂ∏Ç‰∏≠Â§ÆÂå∫">
                </div>

                <div class="form-group">
                    <label>‰ª£Ë°®ËÄÖÊ∞èÂêç<span class="required">*</span></label>
                    <input type="text" id="contactName" name="representative" placeholder="‰æã: Èà¥Êú®Â§™ÈÉé">
                </div>

                <div class="form-group">
                    <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ<span class="required">*</span></label>
                    <input type="email" id="contactEmail" name="email" placeholder="‰æã: suzuki@example.com">
                </div>

                <div class="form-group">
                    <label>ÈõªË©±Áï™Âè∑</label>
                    <input type="tel" id="contactPhone" name="phone" placeholder="‰æã: 011-123-4567">
                </div>
            </div>

            <!-- Á®ÆÁõÆÂà•Âá∫Â†¥Êï∞ÈÅ∏Êäû -->
            <div class="form-section">
                <h3>Á®ÆÁõÆÂà•Âá∫Â†¥Êï∞ÈÅ∏Êäû</h3>
                <p style="color: #6c757d; font-size: 14px; margin-bottom: 15px;">
                    ÂêÑÁ®ÆÁõÆ„ÅÆÂá∫Â†¥Êï∞„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÂÖ•ÂäõÊ¨Ñ„ÅØË°®Á§∫„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
                </p>
                
                <div class="category-selection">
                    <div class="category-card">
                        <h4>üîµ Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„ÇπÔºàBSÔºâ</h4>
                        <select id="msCount" onchange="generateFields()">
                            <option value="0">Âá∫Â†¥„Å™„Åó</option>
                        </select>
                    </div>

                    <div class="category-card">
                        <h4>üî¥ Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„ÇπÔºàGSÔºâ</h4>
                        <select id="wsCount" onchange="generateFields()">
                            <option value="0">Âá∫Â†¥„Å™„Åó</option>
                        </select>
                    </div>

                    <div class="category-card">
                        <h4>üîµüîµ Áî∑Â≠ê„ÉÄ„Éñ„É´„ÇπÔºàBDÔºâ</h4>
                        <select id="mdCount" onchange="generateFields()">
                            <option value="0">Âá∫Â†¥„Å™„Åó</option>
                        </select>
                    </div>

                    <div class="category-card">
                        <h4>üî¥üî¥ Â•≥Â≠ê„ÉÄ„Éñ„É´„ÇπÔºàGDÔºâ</h4>
                        <select id="wdCount" onchange="generateFields()">
                            <option value="0">Âá∫Â†¥„Å™„Åó</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ÂãïÁöÑÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ -->
            <div id="entryFieldsContainer"></div>

            <!-- „Éú„Çø„É≥ -->
            <div class="button-group">
                <button class="btn btn-primary" id="submitBtn" onclick="submitForm()">
                    üîµ ÁôªÈå≤„Åô„Çã
                </button>
                <button class="btn btn-secondary" onclick="clearForm()">
                    üü° „ÇØ„É™„Ç¢
                </button>
            </div>
        </div>

        <!-- „Çø„Éñ2: ÁôªÈå≤Áä∂Ê≥Å -->
        <div class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Á∑èÁôªÈå≤‰∫∫Êï∞</h3>
                    <div class="value" id="totalPlayers">-</div>
                </div>
                <div class="stat-card">
                    <h3>ÂèÇÂä†Â≠¶Ê†°Êï∞</h3>
                    <div class="value" id="totalSchools">-</div>
                </div>
                <div class="stat-card">
                    <h3>„ÉÄ„Éñ„É´„ÇπÁµÑÊï∞</h3>
                    <div class="value" id="totalPairs">-</div>
                </div>
            </div>

            <div class="form-section">
                <h3>Á®ÆÁõÆÂà•ÈõÜË®à</h3>
                <div id="categoryStats">
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        „Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>Â≠¶Ê†°Âà•ÈõÜË®à</h3>
                <div id="schoolStats">
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        „Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...
                    </div>
                </div>
            </div>

            <h3 style="color: #667eea; margin-bottom: 15px;">üìã ÁôªÈå≤ËÄÖ‰∏ÄË¶ß</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Â≠¶Ê†°Âêç</th>
                            <th>Á®ÆÁõÆ</th>
                            <th>ÈÅ∏ÊâãÂêç</th>
                            <th>Â≠¶Âπ¥</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="playerList">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #6c757d;">
                                „Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- „Çø„Éñ3: ÁÆ°ÁêÜ„ÉªÂá∫Âäõ -->
        <div class="tab-content">
            <div class="admin-section">
                <h3>üîê ÁÆ°ÁêÜËÄÖË™çË®º</h3>
                <div class="password-input">
                    <input type="password" id="adminPassword" placeholder="ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                    <button class="btn btn-primary" onclick="adminLogin()" style="flex: 0 0 120px;">„É≠„Ç∞„Ç§„É≥</button>
                </div>
                <p style="font-size: 12px; color: #856404;">‚Äª„Éë„Çπ„ÉØ„Éº„Éâ: <strong>badminton2024</strong></p>
            </div>

            <div id="adminPanel" class="hidden">
                <div class="form-section">
                    <h3>üì• „Éá„Éº„ÇøÂá∫Âäõ</h3>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="exportAllCSV()">
                            üìÑ ÂÖ®„Éá„Éº„ÇøCSVÂá∫Âäõ
                        </button>
                        <button class="btn btn-success" onclick="exportByCategoryCSV()">
                            üìä Á®ÆÁõÆÂà•CSVÂá∫Âäõ
                        </button>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üì§ Phase 2ÈÄ£Êê∫</h3>
                    <p style="margin-bottom: 15px; color: #495057;">
                        Phase 2ÔºàÁµÑ„ÅøÂêà„Çè„Åõ‰ΩúÊàêÔºâ„Åß‰ΩøÁî®„Åô„Çã„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ
                    </p>
                    <button class="btn btn-primary" onclick="exportForPhase2()">
                        üöÄ Phase 2Áî®„Éá„Éº„ÇøÂá∫Âäõ
                    </button>
                </div>

                <div class="form-section">
                    <h3>üóëÔ∏è „Éá„Éº„ÇøÁÆ°ÁêÜ</h3>
                    <button class="btn btn-secondary" onclick="confirmClearAll()">
                        ‚ö´ ÂÖ®„Éá„Éº„Çø„ÇØ„É™„Ç¢
                    </button>
                    <p style="font-size: 12px; color: #6c757d; margin-top: 10px;">
                        ‚ö†Ô∏è ÂÖ®„Éá„Éº„Çø„ÇØ„É™„Ç¢„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇÊÖéÈáç„Å´ÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // Ë®≠ÂÆö
        // ============================================
        // ‚Äª‚Äª‚Äª ÈáçË¶Å ‚Äª‚Äª‚Äª
        // Google Apps Script„Çí„Éá„Éó„É≠„Ç§„Åó„ÅüÂæå„ÄÅ‰ª•‰∏ã„ÅÆURL„ÇíÊõ¥Êñ∞„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        // 1. Apps Script„Ç®„Éá„Ç£„Çø„Åß„Äå„Éá„Éó„É≠„Ç§„Äç‚Üí„Äå„Éá„Éó„É≠„Ç§„ÇíÁÆ°ÁêÜ„Äç
        // 2. „Ç¶„Çß„Éñ„Ç¢„Éó„É™URL„Çí„Ç≥„Éî„Éº
        // 3. ‰ª•‰∏ã„ÅÆSCRIPT_URL„Å´Ë≤º„Çä‰ªò„Åë
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKZJXoe4vVMjczJRB7jBDSZqxU7U3BjEcT8I2s-vkDTfXJrOZSSYr3mf7K5bJKnPan/exec';

        // ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥Áä∂ÊÖã
        let isAdminLoggedIn = false;

        // ============================================
        // ÂàùÊúüÂåñ
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeSelectOptions();
            loadData();
        });

        // „Çª„É¨„ÇØ„Éà„Éú„ÉÉ„ÇØ„ÇπÂàùÊúüÂåñ
        function initializeSelectOptions() {
            const selects = ['msCount', 'wsCount', 'mdCount', 'wdCount'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                for (let i = 1; i <= 100; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    select.appendChild(option);
                }
            });
        }

        // ============================================
        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        // ============================================
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            tabs[index].classList.add('active');
            contents[index].classList.add('active');

            if (index === 1) {
                loadData();
            }
        }

        // Â≠¶Ê†°Âêç„Çµ„Ç∏„Çß„Çπ„Éà„ÅØÂâäÈô§Ôºà‰∏çË¶ÅÔºâ

        // ============================================
        // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâÂãïÁöÑÁîüÊàê
        // ============================================
        function generateFields() {
            const container = document.getElementById('entryFieldsContainer');
            container.innerHTML = '';

            const categories = [
                { id: 'msCount', name: 'Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ', type: 'singles', color: '#0066cc' },
                { id: 'wsCount', name: 'Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ', type: 'singles', color: '#cc0066' },
                { id: 'mdCount', name: 'Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ', type: 'doubles', color: '#0066cc' },
                { id: 'wdCount', name: 'Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ', type: 'doubles', color: '#cc0066' }
            ];

            categories.forEach(cat => {
                const count = parseInt(document.getElementById(cat.id).value);
                if (count > 0) {
                    const section = createCategorySection(cat, count);
                    container.appendChild(section);
                }
            });
        }

        function createCategorySection(category, count) {
            const section = document.createElement('div');
            section.className = 'form-section';
            
            const header = document.createElement('h3');
            header.textContent = `${category.name}Ôºà${count}${category.type === 'singles' ? '‰∫∫' : 'ÁµÑ'}Ôºâ`;
            header.style.borderLeft = `4px solid ${category.color}`;
            header.style.paddingLeft = '10px';
            section.appendChild(header);

            for (let i = 0; i < count; i++) {
                if (category.type === 'singles') {
                    section.appendChild(createSinglesEntry(category.id, i + 1));
                } else {
                    section.appendChild(createDoublesEntry(category.id, i + 1));
                }
            }

            return section;
        }

        function createSinglesEntry(categoryId, index) {
            const group = document.createElement('div');
            group.className = 'entry-group';
            group.innerHTML = `
                <div class="entry-header">ÂèÇÂä†ËÄÖ ${index}</div>
                <div class="form-group">
                    <label>Ê∞èÂêç<span class="required">*</span></label>
                    <input type="text" class="player-name" data-category="${categoryId}" data-index="${index}" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                </div>
                <div class="form-group">
                    <label>„Éï„É™„Ç¨„Éä<span class="required">*</span></label>
                    <input type="text" class="player-kana" data-category="${categoryId}" data-index="${index}" placeholder="‰æã: „É§„Éû„ÉÄ„Çø„É≠„Ç¶">
                </div>
                <div class="form-group">
                    <label>Â≠¶Âπ¥<span class="required">*</span></label>
                    <select class="player-grade" data-category="${categoryId}" data-index="${index}">
                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        <option value="1Âπ¥">1Âπ¥</option>
                        <option value="2Âπ¥">2Âπ¥</option>
                        <option value="3Âπ¥">3Âπ¥</option>
                    </select>
                </div>
            `;
            return group;
        }

        function createDoublesEntry(categoryId, index) {
            const group = document.createElement('div');
            group.className = 'entry-group';
            group.innerHTML = `
                <div class="entry-header">„Éö„Ç¢ ${index}</div>
                
                <div class="pair-section">
                    <h5>üë§ „Éö„Ç¢A</h5>
                    <div class="form-group">
                        <label>Ê∞èÂêç<span class="required">*</span></label>
                        <input type="text" class="pair-a-name" data-category="${categoryId}" data-index="${index}" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                    </div>
                    <div class="form-group">
                        <label>„Éï„É™„Ç¨„Éä<span class="required">*</span></label>
                        <input type="text" class="pair-a-kana" data-category="${categoryId}" data-index="${index}" placeholder="‰æã: „É§„Éû„ÉÄ„Çø„É≠„Ç¶">
                    </div>
                    <div class="form-group">
                        <label>Â≠¶Âπ¥<span class="required">*</span></label>
                        <select class="pair-a-grade" data-category="${categoryId}" data-index="${index}">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="1Âπ¥">1Âπ¥</option>
                            <option value="2Âπ¥">2Âπ¥</option>
                            <option value="3Âπ¥">3Âπ¥</option>
                        </select>
                    </div>
                </div>

                <div class="pair-section">
                    <h5>üë§ „Éö„Ç¢B</h5>
                    <div class="form-group">
                        <label>Ê∞èÂêç<span class="required">*</span></label>
                        <input type="text" class="pair-b-name" data-category="${categoryId}" data-index="${index}" placeholder="‰æã: ‰ΩêËó§Ëä±Â≠ê">
                    </div>
                    <div class="form-group">
                        <label>„Éï„É™„Ç¨„Éä<span class="required">*</span></label>
                        <input type="text" class="pair-b-kana" data-category="${categoryId}" data-index="${index}" placeholder="‰æã: „Çµ„Éà„Ç¶„Éè„Éä„Ç≥">
                    </div>
                    <div class="form-group">
                        <label>Â≠¶Âπ¥<span class="required">*</span></label>
                        <select class="pair-b-grade" data-category="${categoryId}" data-index="${index}">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="1Âπ¥">1Âπ¥</option>
                            <option value="2Âπ¥">2Âπ¥</option>
                            <option value="3Âπ¥">3Âπ¥</option>
                        </select>
                    </div>
                </div>
            `;
            return group;
        }

        // ============================================
        // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        // ============================================
        async function submitForm() {
            if (!validateForm()) return;

            const data = collectFormData();
            
            // „Éá„Éê„ÉÉ„Ç∞ÔºöcollectFormData„ÅÆÁµêÊûú„ÇíÂá∫Âäõ
            console.log('=== collectFormDataÁµêÊûú ===');
            console.log('schoolName:', data.schoolName);
            console.log('schoolAddress:', data.schoolAddress);
            console.log('contactName:', data.contactName);
            console.log('contactEmail:', data.contactEmail);
            console.log('contactPhone:', data.contactPhone);
            console.log('entries:', data.entries);
            console.log('========================');
            const submitBtn = document.getElementById('submitBtn');
            
            // „Éú„Çø„É≥ÁÑ°ÂäπÂåñ
            submitBtn.disabled = true;
            showAlert('info', 'ÈÄÅ‰ø°‰∏≠...„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ');

            try {
                const formData = new FormData();
                formData.append('action', 'register');
                formData.append('schoolName', data.schoolName);
                formData.append('address', data.schoolAddress || '');
                formData.append('representative', data.contactName);
                formData.append('email', data.contactEmail);
                formData.append('phone', data.contactPhone || '');
                
                // Á®ÆÁõÆÂà•Âá∫Â†¥Êï∞
                formData.append('BS', data.entries.filter(e => e.category === 'BS').length);
                formData.append('GS', data.entries.filter(e => e.category === 'GS').length);
                formData.append('BD', data.entries.filter(e => e.category === 'BD').length);
                formData.append('GD', data.entries.filter(e => e.category === 'GD').length);
                
                // ÈÅ∏ÊâãÊÉÖÂ†±
                const categoryCounts = { BS: 0, GS: 0, BD: 0, GD: 0 };
                data.entries.forEach(entry => {
                    categoryCounts[entry.category]++;
                    const index = categoryCounts[entry.category];
                    
                    formData.append(`${entry.category}_${index}_player1_name`, entry.player1Name);
                    formData.append(`${entry.category}_${index}_player1_kana`, entry.player1Kana);
                    formData.append(`${entry.category}_${index}_player1_grade`, entry.player1Grade);
                    
                    if (entry.category === 'BD' || entry.category === 'GD') {
                        formData.append(`${entry.category}_${index}_player2_name`, entry.player2Name || '');
                        formData.append(`${entry.category}_${index}_player2_kana`, entry.player2Kana || '');
                        formData.append(`${entry.category}_${index}_player2_grade`, entry.player2Grade || '');
                    }
                });
                
                // „Éá„Éê„ÉÉ„Ç∞ÔºöFormData„ÅÆÂÜÖÂÆπ„ÇíÂá∫Âäõ
                console.log('=== FormDataÈÄÅ‰ø°ÂÜÖÂÆπ ===');
                for (let pair of formData.entries()) {
                    console.log(pair[0] + ': ' + pair[1]);
                }
                console.log('========================');

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('„Çµ„Éº„Éê„Éº„Ç®„É©„Éº: ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', '‚úÖ ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
                    clearForm();
                    
                    // 3ÁßíÂæå„Å´ÁôªÈå≤Áä∂Ê≥Å„Çø„Éñ„Å´ÁßªÂãï
                    setTimeout(() => {
                        switchTab(1);
                    }, 3000);
                } else {
                    showAlert('error', '‚ùå ' + (result.message || 'ÁôªÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
                }
                
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', '‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                submitBtn.disabled = false;
            }
        }

        function validateForm() {
            const schoolName = document.getElementById('schoolName').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();

            if (!schoolName) {
                showAlert('error', '‚ùå Â≠¶Ê†°Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            if (!contactName) {
                showAlert('error', '‚ùå ‰ª£Ë°®ËÄÖÊ∞èÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            if (!contactEmail) {
                showAlert('error', '‚ùå „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(contactEmail)) {
                showAlert('error', '‚ùå „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
                return false;
            }

            // Á®ÆÁõÆ„Åå1„Å§„ÇÇÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const msCount = parseInt(document.getElementById('msCount').value);
            const wsCount = parseInt(document.getElementById('wsCount').value);
            const mdCount = parseInt(document.getElementById('mdCount').value);
            const wdCount = parseInt(document.getElementById('wdCount').value);

            if (msCount + wsCount + mdCount + wdCount === 0) {
                showAlert('error', '‚ùå Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆÁ®ÆÁõÆ„ÅßÂá∫Â†¥Êï∞„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            // ÂÖ•ÂäõÊ¨Ñ„ÅÆÂøÖÈ†à„ÉÅ„Çß„ÉÉ„ÇØ
            const allInputs = document.querySelectorAll('#entryFieldsContainer input[type="text"], #entryFieldsContainer select');
            for (let input of allInputs) {
                if (!input.value.trim()) {
                    showAlert('error', '‚ùå „Åô„Åπ„Å¶„ÅÆÂøÖÈ†àÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    input.focus();
                    return false;
                }
            }

            return true;
        }

        function collectFormData() {
            const schoolName = document.getElementById('schoolName').value.trim();
            const schoolAddress = document.getElementById('address').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();
            const contactPhone = document.getElementById('contactPhone').value.trim();

            const entries = [];

            // Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ
            const msCount = parseInt(document.getElementById('msCount').value);
            for (let i = 1; i <= msCount; i++) {
                const name = document.querySelector(`.player-name[data-category="msCount"][data-index="${i}"]`).value;
                const kana = document.querySelector(`.player-kana[data-category="msCount"][data-index="${i}"]`).value;
                const grade = document.querySelector(`.player-grade[data-category="msCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'BS',
                    player1Name: name,
                    player1Kana: kana,
                    player1Grade: grade,
                    player2Name: '',
                    player2Kana: '',
                    player2Grade: ''
                });
            }

            // Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ
            const wsCount = parseInt(document.getElementById('wsCount').value);
            for (let i = 1; i <= wsCount; i++) {
                const name = document.querySelector(`.player-name[data-category="wsCount"][data-index="${i}"]`).value;
                const kana = document.querySelector(`.player-kana[data-category="wsCount"][data-index="${i}"]`).value;
                const grade = document.querySelector(`.player-grade[data-category="wsCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'GS',
                    player1Name: name,
                    player1Kana: kana,
                    player1Grade: grade,
                    player2Name: '',
                    player2Kana: '',
                    player2Grade: ''
                });
            }

            // Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ
            const mdCount = parseInt(document.getElementById('mdCount').value);
            for (let i = 1; i <= mdCount; i++) {
                const nameA = document.querySelector(`.pair-a-name[data-category="mdCount"][data-index="${i}"]`).value;
                const kanaA = document.querySelector(`.pair-a-kana[data-category="mdCount"][data-index="${i}"]`).value;
                const gradeA = document.querySelector(`.pair-a-grade[data-category="mdCount"][data-index="${i}"]`).value;
                const nameB = document.querySelector(`.pair-b-name[data-category="mdCount"][data-index="${i}"]`).value;
                const kanaB = document.querySelector(`.pair-b-kana[data-category="mdCount"][data-index="${i}"]`).value;
                const gradeB = document.querySelector(`.pair-b-grade[data-category="mdCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'BD',
                    player1Name: nameA,
                    player1Kana: kanaA,
                    player1Grade: gradeA,
                    player2Name: nameB,
                    player2Kana: kanaB,
                    player2Grade: gradeB
                });
            }

            // Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ
            const wdCount = parseInt(document.getElementById('wdCount').value);
            for (let i = 1; i <= wdCount; i++) {
                const nameA = document.querySelector(`.pair-a-name[data-category="wdCount"][data-index="${i}"]`).value;
                const kanaA = document.querySelector(`.pair-a-kana[data-category="wdCount"][data-index="${i}"]`).value;
                const gradeA = document.querySelector(`.pair-a-grade[data-category="wdCount"][data-index="${i}"]`).value;
                const nameB = document.querySelector(`.pair-b-name[data-category="wdCount"][data-index="${i}"]`).value;
                const kanaB = document.querySelector(`.pair-b-kana[data-category="wdCount"][data-index="${i}"]`).value;
                const gradeB = document.querySelector(`.pair-b-grade[data-category="wdCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'GD',
                    player1Name: nameA,
                    player1Kana: kanaA,
                    player1Grade: gradeA,
                    player2Name: nameB,
                    player2Kana: kanaB,
                    player2Grade: gradeB
                });
            }

            return {
                schoolName,
                schoolAddress,
                contactName,
                contactEmail,
                contactPhone,
                entries
            };
        }

        function clearForm() {
            document.getElementById('schoolName').value = '';
            document.getElementById('address').value = '';
            document.getElementById('contactName').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactPhone').value = '';
            
            document.getElementById('msCount').value = '0';
            document.getElementById('wsCount').value = '0';
            document.getElementById('mdCount').value = '0';
            document.getElementById('wdCount').value = '0';
            
            document.getElementById('entryFieldsContainer').innerHTML = '';
        }

        // ============================================
        // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        // ============================================
        async function loadData() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData', {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                if (!response.ok) {
                    throw new Error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº: ' + response.status);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Apps Script„Åã„Çâ„ÅÆ„Éá„Éº„Çø„Çí„Åù„ÅÆ„Åæ„Åæ‰ΩøÁî®
                    const players = result.data.players || [];
                    const schools = result.data.schools || [];
                    
                    console.log('Players:', players);
                    console.log('Schools:', schools);
                    
                    updateStats(players, schools);
                    updatePlayerList(players);
                } else {
                    console.error('„Éá„Éº„ÇøÂèñÂæóÂ§±Êïó:', result.message);
                    updateStatsEmpty();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                updateStatsEmpty();
            }
        }

        function updateStatsEmpty() {
            document.getElementById('totalPlayers').textContent = '0';
            document.getElementById('totalSchools').textContent = '0';
            document.getElementById('totalPairs').textContent = '0';
            document.getElementById('categoryStats').innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
            document.getElementById('schoolStats').innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
            document.getElementById('playerList').innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>';
        }

        function updateStats(players, schools) {
            if (!players || players.length === 0) {
                updateStatsEmpty();
                return;
            }

            const totalPlayers = players.length;
            const uniqueSchools = new Set(players.map(p => p.schoolName));
            const pairs = players.filter(p => p.category === 'BD' || p.category === 'GD').length;

            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('totalSchools').textContent = uniqueSchools.size;
            document.getElementById('totalPairs').textContent = pairs;

            // Á®ÆÁõÆÂà•ÈõÜË®à
            const categoryCount = { 'BS': 0, 'GS': 0, 'BD': 0, 'GD': 0 };
            players.forEach(p => {
                if (p.category && categoryCount.hasOwnProperty(p.category)) {
                    categoryCount[p.category]++;
                }
            });
            
            const categoryNames = {
                'BS': 'Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ',
                'GS': 'Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ',
                'BD': 'Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ',
                'GD': 'Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ'
            };

            const categoryStatsHTML = Object.entries(categoryCount)
                .filter(([cat, count]) => count > 0)
                .map(([cat, count]) => `
                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; margin: 5px 0; border-radius: 5px;">
                    <span>${categoryNames[cat]}</span>
                    <strong style="color: #667eea;">${count}${cat === 'BD' || cat === 'GD' ? 'ÁµÑ' : '‰∫∫'}</strong>
                </div>
            `).join('');
            document.getElementById('categoryStats').innerHTML = categoryStatsHTML || '<div style="text-align: center; color: #6c757d; padding: 20px;">„Éá„Éº„Çø„Å™„Åó</div>';

            // Â≠¶Ê†°Âà•ÈõÜË®à
            const schoolCount = {};
            players.forEach(p => {
                if (p.schoolName) {
                    schoolCount[p.schoolName] = (schoolCount[p.schoolName] || 0) + 1;
                }
            });

            const schoolStatsHTML = Object.entries(schoolCount).map(([school, count]) => `
                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; margin: 5px 0; border-radius: 5px;">
                    <span>${school}</span>
                    <strong style="color: #667eea;">${count}‰∫∫</strong>
                </div>
            `).join('');
            document.getElementById('schoolStats').innerHTML = schoolStatsHTML || '<div style="text-align: center; color: #6c757d; padding: 20px;">„Éá„Éº„Çø„Å™„Åó</div>';
        }

        function updatePlayerList(data) {
            const tbody = document.getElementById('playerList');
            
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>';
                return;
            }

            tbody.innerHTML = data.map((player, index) => {
                const isDoubles = player.category === 'BD' || player.category === 'GD';
                const categoryNames = {
                    'BS': 'Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ',
                    'GS': 'Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ',
                    'BD': 'Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ',
                    'GD': 'Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ'
                };
                const playerName = isDoubles
                    ? `<strong>„Éö„Ç¢A:</strong> ${player.player1Name || '-'}Ôºà${player.player1Grade || '-'}Ôºâ<br><strong>„Éö„Ç¢B:</strong> ${player.player2Name || '-'}Ôºà${player.player2Grade || '-'}Ôºâ`
                    : player.player1Name || '-';
                const grade = isDoubles ? '-' : (player.player1Grade || '-');

                // ÂâäÈô§„Éú„Çø„É≥„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøË°®Á§∫Ôºà„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Éô„Éº„ÇπÔºâ
                const timestampStr = player.timestamp ? new Date(player.timestamp).toISOString() : '';
                const deleteButton = isAdminLoggedIn 
                    ? `<button class="btn-small btn-delete" onclick="deletePlayer('${timestampStr}', '${player.schoolName}', '${player.player1Name}')">ÂâäÈô§</button>`
                    : '-';

                return `
                    <tr>
                        <td>${player.schoolName || '-'}</td>
                        <td>${categoryNames[player.category] || player.category || '-'}</td>
                        <td>${playerName}</td>
                        <td>${grade}</td>
                        <td>${deleteButton}</td>
                    </tr>
                `;
            }).join('');
        }

        async function deletePlayer(timestamp, schoolName, player1Name) {
            if (!isAdminLoggedIn) {
                showAlert('error', '‚ùå ÁÆ°ÁêÜËÄÖÊ®©Èôê„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }

            if (!confirm('„Åì„ÅÆÁôªÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n\nÂ≠¶Ê†°Ôºö' + schoolName + '\nÈÅ∏ÊâãÔºö' + player1Name + '\n\n‚Äª„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) return;

            try {
                const formData = new FormData();
                formData.append('action', 'deletePlayer');
                formData.append('timestamp', timestamp);
                formData.append('schoolName', schoolName);
                formData.append('player1Name', player1Name);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ÂâäÈô§„Ç®„É©„Éº: ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', '‚úÖ ÂâäÈô§„Åó„Åæ„Åó„Åü');
                    loadData();
                } else {
                    showAlert('error', '‚ùå ' + (result.message || 'ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', '‚ùå „Ç®„É©„Éº: ' + error.message);
            }
        }

        // ============================================
        // ÁÆ°ÁêÜÊ©üËÉΩ
        // ============================================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'badminton2024') {
                isAdminLoggedIn = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                showAlert('success', '‚úÖ ÁÆ°ÁêÜËÄÖË™çË®ºÊàêÂäü');
                // ÂâäÈô§„Éú„Çø„É≥„ÇíË°®Á§∫„Åô„Çã„Åü„ÇÅÂÜçË™≠„ÅøËæº„Åø
                loadData();
            } else {
                showAlert('error', '‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô');
            }
        }

        function exportAllCSV() {
            window.open(SCRIPT_URL + '?action=exportCSV', '_blank');
        }

        function exportByCategoryCSV() {
            const category = prompt('Á®ÆÁõÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö\nBS: Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ\nGS: Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ\nBD: Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ\nGD: Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ', 'BS');
            
            if (category && ['BS', 'GS', 'BD', 'GD'].includes(category.toUpperCase())) {
                window.open(SCRIPT_URL + '?action=exportByCategory&category=' + category.toUpperCase(), '_blank');
            } else if (category) {
                alert('ÊúâÂäπ„Å™Á®ÆÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºöBS, GS, BD, GD');
            }
        }

        function exportForPhase2() {
            window.open(SCRIPT_URL + '?action=exportForPhase2', '_blank');
        }

        async function confirmClearAll() {
            if (!confirm('‚ö†Ô∏è Êú¨ÂΩì„Å´ÂÖ®„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ')) return;
            
            const password = prompt('ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (password !== 'badminton2024') {
                showAlert('error', '‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('action', 'clearAll');
                formData.append('password', password);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('„ÇØ„É™„Ç¢„Ç®„É©„Éº: ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', '‚úÖ ÂÖ®„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
                    loadData();
                } else {
                    showAlert('error', '‚ùå ' + (result.message || '„ÇØ„É™„Ç¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', '‚ùå „Ç®„É©„Éº: ' + error.message);
            }
        }

        // ============================================
        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
        // ============================================
        function showAlert(type, message) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.className = `alert alert-${type} show`;
            alertDiv.textContent = message;
            
            // Ëá™ÂãïÁöÑ„Å´Ê∂à„Åà„Çã
            setTimeout(() => {
                alertDiv.classList.remove('show');
            }, 5000);

            // ÁîªÈù¢ÊúÄ‰∏äÈÉ®„Å´„Çπ„ÇØ„É≠„Éº„É´
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // „ÇØ„É™„ÉÉ„ÇØ„Åß„Çµ„Ç∏„Çß„Çπ„ÉàÈñâ„Åò„Çã
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#schoolName')) {
                document.getElementById('schoolSuggestions')?.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
