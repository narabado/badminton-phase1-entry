<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å¤§ä¼š å‡ºå ´è€…ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ  - Phase 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            color: #495057;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 1.1em;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 3.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .form-section h2::before {
            content: 'ğŸ“';
            margin-right: 15px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
            font-size: 1em;
        }

        .form-group label .required {
            color: #dc3545;
            margin-left: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .pair-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .pair-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 18px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 12px 24px;
            font-size: 1em;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            font-size: 1em;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
            padding: 12px 24px;
            font-size: 1em;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .data-section {
            margin-top: 30px;
        }

        .data-section h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            font-size: 0.9em;
        }

        tbody tr {
            transition: background 0.3s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
            font-size: 1.1em;
        }

        /* ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .admin-login {
            max-width: 500px;
            margin: 0 auto;
        }

        .admin-login h2 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-align: center;
        }

        .admin-login .form-group {
            margin-bottom: 25px;
        }

        .admin-login input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1em;
        }

        .admin-login .btn {
            width: 100%;
            padding: 18px;
            font-size: 1.1em;
        }

        /* ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .admin-menu {
            background: #fff3cd;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* ã‚¢ãƒ©ãƒ¼ãƒˆ */
        .alert {
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-size: 1em;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tab {
                font-size: 0.9em;
                padding: 15px 10px;
            }

            .stat-card .number {
                font-size: 2.5em;
            }

            th, td {
                font-size: 0.85em;
                padding: 10px 8px;
            }

            .button-group {
                flex-direction: column;
            }

            .admin-menu {
                flex-direction: column;
            }
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¸ ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å¤§ä¼š å‡ºå ´è€…ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>Phase 1: å‡ºå ´è€…ç™»éŒ²ãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('entry')">ğŸ“‹ å‡ºå ´è€…ç™»éŒ²</button>
            <button class="tab" onclick="switchTab('list')">ğŸ“Š ç™»éŒ²çŠ¶æ³</button>
            <button class="tab" onclick="switchTab('admin')">âš™ï¸ ç®¡ç†</button>
        </div>

        <!-- Tab 1: å‡ºå ´è€…ç™»éŒ² -->
        <div id="entry-tab" class="tab-content active">
            <div class="stats-container">
                <div class="stat-card">
                    <h3>å‚åŠ å­¦æ ¡æ•°</h3>
                    <div class="number" id="stat-schools">0</div>
                </div>
                <div class="stat-card">
                    <h3>ç¾åœ¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°</h3>
                    <div class="number" id="stat-current">0</div>
                </div>
                <div class="stat-card">
                    <h3>æ–°ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°</h3>
                    <div class="number" id="stat-new">0</div>
                </div>
            </div>

            <div class="form-section">
                <h2>æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼ç™»éŒ²</h2>
                
                <div class="form-group">
                    <label>å­¦æ ¡å<span class="required">*</span></label>
                    <input type="text" id="schoolName" placeholder="ä¾‹: æœ­å¹Œè¥¿åˆ" required>
                </div>

                <div class="form-group">
                    <label>ç¨®ç›®<span class="required">*</span></label>
                    <select id="category" required onchange="handleCategoryChange()">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹">ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹</option>
                        <option value="å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹">å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹</option>
                        <option value="ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹">ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹</option>
                        <option value="å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹">å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹</option>
                        <option value="æ··åˆãƒ€ãƒ–ãƒ«ã‚¹">æ··åˆãƒ€ãƒ–ãƒ«ã‚¹</option>
                    </select>
                </div>

                <div id="singles-form" style="display: none;">
                    <div class="form-group">
                        <label>é¸æ‰‹å<span class="required">*</span></label>
                        <input type="text" id="player1Name-single" placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
                        <input type="text" id="player1Furigana-single" placeholder="ä¾‹: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦">
                    </div>
                    <div class="form-group">
                        <label>å­¦å¹´<span class="required">*</span></label>
                        <select id="player1Grade-single">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="1å¹´">1å¹´</option>
                            <option value="2å¹´">2å¹´</option>
                            <option value="3å¹´">3å¹´</option>
                        </select>
                    </div>
                </div>

                <div id="doubles-form" style="display: none;">
                    <div class="pair-section">
                        <h3>ğŸ‘¤ ãƒšã‚¢1</h3>
                        <div class="form-group">
                            <label>é¸æ‰‹å<span class="required">*</span></label>
                            <input type="text" id="player1Name-double" placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
                        </div>
                        <div class="form-group">
                            <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
                            <input type="text" id="player1Furigana-double" placeholder="ä¾‹: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦">
                        </div>
                        <div class="form-group">
                            <label>å­¦å¹´<span class="required">*</span></label>
                            <select id="player1Grade-double">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1å¹´">1å¹´</option>
                                <option value="2å¹´">2å¹´</option>
                                <option value="3å¹´">3å¹´</option>
                            </select>
                        </div>
                    </div>

                    <div class="pair-section">
                        <h3>ğŸ‘¤ ãƒšã‚¢2</h3>
                        <div class="form-group">
                            <label>é¸æ‰‹å<span class="required">*</span></label>
                            <input type="text" id="player2Name" placeholder="ä¾‹: ä½è—¤èŠ±å­">
                        </div>
                        <div class="form-group">
                            <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
                            <input type="text" id="player2Furigana" placeholder="ä¾‹: ã‚µãƒˆã‚¦ãƒãƒŠã‚³">
                        </div>
                        <div class="form-group">
                            <label>å­¦å¹´<span class="required">*</span></label>
                            <select id="player2Grade">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1å¹´">1å¹´</option>
                                <option value="2å¹´">2å¹´</option>
                                <option value="3å¹´">3å¹´</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="submitEntry()">âœ… ç™»éŒ²ã™ã‚‹</button>
                    <button class="btn btn-secondary" onclick="clearForm()">ğŸ”„ ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>

        <!-- Tab 2: ç™»éŒ²çŠ¶æ³ -->
        <div id="list-tab" class="tab-content">
            <div class="data-section">
                <h2>ğŸ“‹ ç¨®ç›®åˆ¥é›†è¨ˆ</h2>
                <div id="category-stats" class="table-container">
                    <div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
                </div>
            </div>

            <div class="data-section">
                <h2>ğŸ“Š å…¨ä½“é›†è¨ˆ (å…¨ã‚«ãƒ†ã‚´ãƒªãƒ¼)</h2>
                <div id="overall-list" class="table-container">
                    <div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
                </div>
            </div>

            <div class="data-section">
                <h2>ğŸ« å­¦æ ¡åˆ¥é›†è¨ˆ</h2>
                <div id="school-stats" class="table-container">
                    <div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
                </div>
            </div>
        </div>

        <!-- Tab 3: ç®¡ç† -->
        <div id="admin-tab" class="tab-content">
            <div id="admin-login-section" class="admin-login">
                <h2>ğŸ” ç®¡ç†è€…èªè¨¼</h2>
                <div class="form-group">
                    <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="adminPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
                </div>
                <button class="btn btn-primary" onclick="adminLogin()">ğŸ”“ ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>

            <div id="admin-panel" style="display: none;">
                <div class="admin-menu">
                    <button class="btn btn-primary" onclick="showActiveEntries()">ğŸ“‹ é¸æ‰‹ä¸€è¦§ã‚’è¦‹ã‚‹ (å€‹åˆ¥å‰Šé™¤)</button>
                    <button class="btn btn-secondary" onclick="exportData()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
                </div>

                <div class="data-section">
                    <h2>ğŸ“‹ å‰Šé™¤æ¸ˆã¿é¸æ‰‹</h2>
                    <div id="deleted-list" class="table-container">
                        <div class="spinner"></div>
                    </div>
                </div>

                <div class="data-section" id="active-entries-section" style="display: none;">
                    <h2>ğŸ“‹ ç¾åœ¨ã®é¸æ‰‹ä¸€è¦§</h2>
                    <div id="active-list" class="table-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKZJXoe4vVMjczJRB7jBDSZqxU7U3BjEcT8I2s-vkDTfXJrOZSSYr3mf7K5bJKnPan/exec';
        const ADMIN_PASSWORD = 'badminton2024';

        let allData = [];
        let deletedData = [];

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'entry') {
                loadStats();
            } else if (tabName === 'list') {
                loadData();
            }
        }

        // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadStats() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getStats');
                const result = await response.json();
                
                console.log('â– â–  ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ‡ãƒãƒƒã‚°æƒ…å ± â– â– ');
                console.log('API ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ä½“:', result);
                
                if (result.success) {
                    document.getElementById('stat-schools').textContent = result.data.totalSchools;
                    document.getElementById('stat-current').textContent = result.data.totalEntries;
                    document.getElementById('stat-new').textContent = result.data.newEntries;
                } else {
                    console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:', result.message);
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼å¤‰æ›´æ™‚ã®å‡¦ç†
        function handleCategoryChange() {
            const category = document.getElementById('category').value;
            const singlesForm = document.getElementById('singles-form');
            const doublesForm = document.getElementById('doubles-form');

            if (category.includes('ã‚·ãƒ³ã‚°ãƒ«ã‚¹')) {
                singlesForm.style.display = 'block';
                doublesForm.style.display = 'none';
            } else if (category.includes('ãƒ€ãƒ–ãƒ«ã‚¹')) {
                singlesForm.style.display = 'none';
                doublesForm.style.display = 'block';
            } else {
                singlesForm.style.display = 'none';
                doublesForm.style.display = 'none';
            }
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼é€ä¿¡
        async function submitEntry() {
            const schoolName = document.getElementById('schoolName').value;
            const category = document.getElementById('category').value;

            if (!schoolName || !category) {
                showAlert('å­¦æ ¡åã¨ç¨®ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const isSingles = category.includes('ã‚·ãƒ³ã‚°ãƒ«ã‚¹');
            let formData = new FormData();
            formData.append('action', 'addEntry');
            formData.append('schoolName', schoolName);
            formData.append('category', category);
            formData.append('isSingles', isSingles);

            if (isSingles) {
                const player1Name = document.getElementById('player1Name-single').value;
                const player1Furigana = document.getElementById('player1Furigana-single').value;
                const player1Grade = document.getElementById('player1Grade-single').value;

                if (!player1Name || !player1Furigana || !player1Grade) {
                    showAlert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                    return;
                }

                formData.append('player1Name', player1Name);
                formData.append('player1Furigana', player1Furigana);
                formData.append('player1Grade', player1Grade);
            } else {
                const player1Name = document.getElementById('player1Name-double').value;
                const player1Furigana = document.getElementById('player1Furigana-double').value;
                const player1Grade = document.getElementById('player1Grade-double').value;
                const player2Name = document.getElementById('player2Name').value;
                const player2Furigana = document.getElementById('player2Furigana').value;
                const player2Grade = document.getElementById('player2Grade').value;

                if (!player1Name || !player1Furigana || !player1Grade || 
                    !player2Name || !player2Furigana || !player2Grade) {
                    showAlert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                    return;
                }

                formData.append('player1Name', player1Name);
                formData.append('player1Furigana', player1Furigana);
                formData.append('player1Grade', player1Grade);
                formData.append('player2Name', player2Name);
                formData.append('player2Furigana', player2Furigana);
                formData.append('player2Grade', player2Grade);
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('âœ… ç™»éŒ²å®Œäº†ã—ã¾ã—ãŸï¼', 'success');
                    clearForm();
                    loadStats();
                } else {
                    showAlert('âŒ ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error, 'error');
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearForm() {
            document.getElementById('schoolName').value = '';
            document.getElementById('category').value = '';
            document.getElementById('singles-form').style.display = 'none';
            document.getElementById('doubles-form').style.display = 'none';
            
            // ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ•ã‚©ãƒ¼ãƒ 
            document.getElementById('player1Name-single').value = '';
            document.getElementById('player1Furigana-single').value = '';
            document.getElementById('player1Grade-single').value = '';
            
            // ãƒ€ãƒ–ãƒ«ã‚¹ãƒ•ã‚©ãƒ¼ãƒ 
            document.getElementById('player1Name-double').value = '';
            document.getElementById('player1Furigana-double').value = '';
            document.getElementById('player1Grade-double').value = '';
            document.getElementById('player2Name').value = '';
            document.getElementById('player2Furigana').value = '';
            document.getElementById('player2Grade').value = '';
        }

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadData() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData');
                const result = await response.json();

                if (result.success) {
                    allData = result.data;
                    displayCategoryStats();
                    displayOverallList();
                    displaySchoolStats();
                } else {
                    showAlert('ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ' + error, 'error');
            }
        }

        // ç¨®ç›®åˆ¥é›†è¨ˆè¡¨ç¤º
        function displayCategoryStats() {
            const categories = {};
            allData.forEach(entry => {
                if (!categories[entry.category]) {
                    categories[entry.category] = 0;
                }
                categories[entry.category]++;
            });

            let html = '<table><thead><tr><th>ç¨®ç›®</th><th>ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°</th></tr></thead><tbody>';
            Object.keys(categories).sort().forEach(cat => {
                html += `<tr><td>${cat}</td><td>${categories[cat]}</td></tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('category-stats').innerHTML = html;
        }

        // å…¨ä½“ãƒªã‚¹ãƒˆè¡¨ç¤º
        function displayOverallList() {
            if (allData.length === 0) {
                document.getElementById('overall-list').innerHTML = '<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            let html = '<table><thead><tr><th>å­¦æ ¡å</th><th>ç¨®ç›®</th><th>é¸æ‰‹å</th><th>å­¦å¹´</th><th>ç¨®åˆ¥</th></tr></thead><tbody>';
            allData.forEach(entry => {
                const playerInfo = entry.isSingles 
                    ? `${entry.player1Name}`
                    : `${entry.player1Name} / ${entry.player2Name}`;
                const gradeInfo = entry.isSingles
                    ? entry.player1Grade
                    : `${entry.player1Grade} / ${entry.player2Grade}`;
                const typeLabel = entry.isSingles ? 'ã‚·ãƒ³ã‚°ãƒ«ã‚¹' : 'ãƒ€ãƒ–ãƒ«ã‚¹';

                html += `<tr>
                    <td>${entry.schoolName}</td>
                    <td>${entry.category}</td>
                    <td>${playerInfo}</td>
                    <td>${gradeInfo}</td>
                    <td>${typeLabel}</td>
                </tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('overall-list').innerHTML = html;
        }

        // å­¦æ ¡åˆ¥é›†è¨ˆè¡¨ç¤º
        function displaySchoolStats() {
            const schools = {};
            allData.forEach(entry => {
                if (!schools[entry.schoolName]) {
                    schools[entry.schoolName] = 0;
                }
                schools[entry.schoolName]++;
            });

            let html = '<table><thead><tr><th>å­¦æ ¡å</th><th>ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°</th></tr></thead><tbody>';
            Object.keys(schools).sort().forEach(school => {
                html += `<tr><td>${school}</td><td>${schools[school]}</td></tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('school-stats').innerHTML = html;
        }

        // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('admin-login-section').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                loadDeletedData();
            } else {
                showAlert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™', 'error');
            }
        }

        // å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadDeletedData() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getDeletedData');
                const result = await response.json();

                if (result.success) {
                    deletedData = result.data;
                    displayDeletedList();
                } else {
                    document.getElementById('deleted-list').innerHTML = '<div class="no-data">å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                }
            } catch (error) {
                document.getElementById('deleted-list').innerHTML = '<div class="no-data">ã‚¨ãƒ©ãƒ¼: ' + error + '</div>';
            }
        }

        // å‰Šé™¤æ¸ˆã¿ãƒªã‚¹ãƒˆè¡¨ç¤º
        function displayDeletedList() {
            if (deletedData.length === 0) {
                document.getElementById('deleted-list').innerHTML = '<div class="no-data">å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            let html = '<table><thead><tr><th>å­¦æ ¡å</th><th>ç¨®ç›®</th><th>é¸æ‰‹å</th><th>å­¦å¹´</th><th>æ“ä½œ</th></tr></thead><tbody>';
            deletedData.forEach(entry => {
                const playerInfo = entry.isSingles 
                    ? `${entry.player1Name}`
                    : `${entry.player1Name} / ${entry.player2Name}`;
                const gradeInfo = entry.isSingles
                    ? entry.player1Grade
                    : `${entry.player1Grade} / ${entry.player2Grade}`;

                html += `<tr>
                    <td>${entry.schoolName}</td>
                    <td>${entry.category}</td>
                    <td>${playerInfo}</td>
                    <td>${gradeInfo}</td>
                    <td>
                        <button class="btn btn-success" onclick='restoreEntry(${JSON.stringify(entry)})'>â†©ï¸ å…ƒã«æˆ»ã™</button>
                        <button class="btn btn-warning" onclick='permanentDelete(${JSON.stringify(entry)})'>ğŸ—‘ï¸ å®Œå…¨ã«å‰Šé™¤</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('deleted-list').innerHTML = html;
        }

        // æœ‰åŠ¹ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¡¨ç¤º
        async function showActiveEntries() {
            const section = document.getElementById('active-entries-section');
            section.style.display = 'block';
            
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData');
                const result = await response.json();

                if (result.success) {
                    allData = result.data;
                    displayActiveList();
                } else {
                    document.getElementById('active-list').innerHTML = '<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
            } catch (error) {
                document.getElementById('active-list').innerHTML = '<div class="no-data">ã‚¨ãƒ©ãƒ¼: ' + error + '</div>';
            }
        }

        // æœ‰åŠ¹ãƒªã‚¹ãƒˆè¡¨ç¤º
        function displayActiveList() {
            if (allData.length === 0) {
                document.getElementById('active-list').innerHTML = '<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            let html = '<table><thead><tr><th>å­¦æ ¡å</th><th>ç¨®ç›®</th><th>é¸æ‰‹å</th><th>å­¦å¹´</th><th>æ“ä½œ</th></tr></thead><tbody>';
            allData.forEach(entry => {
                const playerInfo = entry.isSingles 
                    ? `${entry.player1Name}`
                    : `${entry.player1Name} / ${entry.player2Name}`;
                const gradeInfo = entry.isSingles
                    ? entry.player1Grade
                    : `${entry.player1Grade} / ${entry.player2Grade}`;

                html += `<tr>
                    <td>${entry.schoolName}</td>
                    <td>${entry.category}</td>
                    <td>${playerInfo}</td>
                    <td>${gradeInfo}</td>
                    <td>
                        <button class="btn btn-danger" onclick='deleteEntry(${JSON.stringify(entry)})'>ğŸ—‘ï¸ å‰Šé™¤</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('active-list').innerHTML = html;
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼å‰Šé™¤ï¼ˆè«–ç†å‰Šé™¤ï¼‰
        async function deleteEntry(entry) {
            if (!confirm(`æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nå­¦æ ¡å: ${entry.schoolName}\nç¨®ç›®: ${entry.category}\né¸æ‰‹: ${entry.player1Name}`)) {
                return;
            }

            const formData = new FormData();
            formData.append('action', 'deleteEntry');
            formData.append('timestamp', entry.timestamp);
            formData.append('schoolName', entry.schoolName);
            formData.append('category', entry.category);
            formData.append('player1Name', entry.player1Name);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                    showActiveEntries();
                    loadDeletedData();
                } else {
                    showAlert('å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + error, 'error');
            }
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼å¾©å…ƒ
        async function restoreEntry(entry) {
            const formData = new FormData();
            formData.append('action', 'restoreEntry');
            formData.append('timestamp', entry.timestamp);
            formData.append('schoolName', entry.schoolName);
            formData.append('category', entry.category);
            formData.append('player1Name', entry.player1Name);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('å¾©å…ƒã—ã¾ã—ãŸ', 'success');
                    loadDeletedData();
                    loadStats();
                } else {
                    showAlert('å¾©å…ƒã‚¨ãƒ©ãƒ¼: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('å¾©å…ƒã‚¨ãƒ©ãƒ¼: ' + error, 'error');
            }
        }

        // å®Œå…¨å‰Šé™¤
        async function permanentDelete(entry) {
            if (!confirm(`å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚\n\nå­¦æ ¡å: ${entry.schoolName}\nç¨®ç›®: ${entry.category}\né¸æ‰‹: ${entry.player1Name}`)) {
                return;
            }

            const formData = new FormData();
            formData.append('action', 'permanentDelete');
            formData.append('timestamp', entry.timestamp);
            formData.append('schoolName', entry.schoolName);
            formData.append('category', entry.category);
            formData.append('player1Name', entry.player1Name);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('å®Œå…¨ã«å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                    loadDeletedData();
                } else {
                    showAlert('å®Œå…¨å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('å®Œå…¨å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + error, 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆä»®å®Ÿè£…ï¼‰
        function exportData() {
            showAlert('ã“ã®æ©Ÿèƒ½ã¯è¿‘æ—¥å®Ÿè£…äºˆå®šã§ã™', 'info');
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(alertDiv, activeTab.firstChild);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            loadStats();
        };
    </script>
</body>
</html>
