<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å¤§ä¼š å‡ºå ´è€…ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ  - Phase 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
        }

        .form-section h3::before {
            content: "ğŸ“";
            margin-right: 8px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group label .required {
            color: #dc3545;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .category-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .category-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .category-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .category-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .entry-group {
            background: #ffffff;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .entry-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .pair-section {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .pair-section h5 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #218838;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow-x: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .school-suggestions {
            position: absolute;
            background: white;
            border: 2px solid #667eea;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            width: calc(100% - 4px);
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .school-suggestion-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #e9ecef;
        }

        .school-suggestion-item:hover {
            background: #f8f9ff;
            color: #667eea;
            font-weight: 600;
        }

        .admin-section {
            background: #fff3cd;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #ffc107;
        }

        .admin-section h3 {
            color: #856404;
            margin-bottom: 20px;
        }

        .password-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .password-input input {
            flex: 1;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .config-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header h1 {
                font-size: 22px;
            }

            .tab {
                font-size: 12px;
                padding: 10px 5px;
            }

            .tab-content {
                padding: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .category-selection {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¸ ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å¤§ä¼š å‡ºå ´è€…ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>Phase 1ï¼šå‡ºå ´è€…ä¸€æ‹¬ç™»éŒ²ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">ğŸ“ å‡ºå ´è€…ç™»éŒ²</div>
            <div class="tab" onclick="switchTab(1)">ğŸ“Š ç™»éŒ²çŠ¶æ³</div>
            <div class="tab" onclick="switchTab(2)">âš™ï¸ ç®¡ç†ãƒ»å‡ºåŠ›</div>
        </div>

        <!-- ã‚¿ãƒ–1: å‡ºå ´è€…ç™»éŒ² -->
        <div class="tab-content active">
            <div id="alertMessage" class="alert"></div>

            <!-- å­¦æ ¡æƒ…å ± -->
            <div class="form-section">
                <h3>å­¦æ ¡æƒ…å ±ãƒ»ä»£è¡¨è€…æƒ…å ±</h3>
                
                <div class="form-group">
                    <label>å­¦æ ¡å<span class="required">*</span></label>
                    <input type="text" id="schoolName" name="schoolName" placeholder="ä¾‹: æœ­å¹ŒåŒ—é«˜æ ¡" autocomplete="off">
                    <div id="schoolSuggestions" class="school-suggestions hidden"></div>
                </div>

                <div class="form-group">
                    <label>ä½æ‰€</label>
                    <input type="text" id="address" name="address" placeholder="ä¾‹: åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒº">
                </div>

                <div class="form-group">
                    <label>ä»£è¡¨è€…æ°å<span class="required">*</span></label>
                    <input type="text" id="contactName" name="representative" placeholder="ä¾‹: éˆ´æœ¨å¤ªéƒ">
                </div>

                <div class="form-group">
                    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="required">*</span></label>
                    <input type="email" id="contactEmail" name="email" placeholder="ä¾‹: suzuki@example.com">
                </div>

                <div class="form-group">
                    <label>é›»è©±ç•ªå·</label>
                    <input type="tel" id="contactPhone" name="phone" placeholder="ä¾‹: 011-123-4567">
                </div>
            </div>

            <!-- ç¨®ç›®åˆ¥å‡ºå ´æ•°é¸æŠ -->
            <div class="form-section">
                <h3>ç¨®ç›®åˆ¥å‡ºå ´æ•°é¸æŠ</h3>
                <p style="color: #6c757d; font-size: 14px; margin-bottom: 15px;">
                    å„ç¨®ç›®ã®å‡ºå ´æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚0ã‚’é¸æŠã™ã‚‹ã¨å…¥åŠ›æ¬„ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚
                </p>
                
                <div class="category-selection">
                    <div class="category-card">
                        <h4>ğŸ”µ ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹ï¼ˆBSï¼‰</h4>
                        <select id="msCount" onchange="generateFields()">
                            <option value="0">å‡ºå ´ãªã—</option>
                        </select>
                    </div>

                    <div class="category-card">
                        <h4>ğŸ”´ å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹ï¼ˆGSï¼‰</h4>
                        <select id="wsCount" onchange="generateFields()">
                            <option value="0">å‡ºå ´ãªã—</option>
                        </select>
                    </div>

                    <div class="category-card">
                        <h4>ğŸ”µğŸ”µ ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹ï¼ˆBDï¼‰</h4>
                        <select id="mdCount" onchange="generateFields()">
                            <option value="0">å‡ºå ´ãªã—</option>
                        </select>
                    </div>

                    <div class="category-card">
                        <h4>ğŸ”´ğŸ”´ å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹ï¼ˆGDï¼‰</h4>
                        <select id="wdCount" onchange="generateFields()">
                            <option value="0">å‡ºå ´ãªã—</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- å‹•çš„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
            <div id="entryFieldsContainer"></div>

            <!-- ãƒœã‚¿ãƒ³ -->
            <div class="button-group">
                <button class="btn btn-primary" id="submitBtn" onclick="submitForm()">
                    ğŸ”µ ç™»éŒ²ã™ã‚‹
                </button>
                <button class="btn btn-secondary" onclick="clearForm()">
                    ğŸŸ¡ ã‚¯ãƒªã‚¢
                </button>
            </div>
        </div>

        <!-- ã‚¿ãƒ–2: ç™»éŒ²çŠ¶æ³ -->
        <div class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>ç·ç™»éŒ²äººæ•°</h3>
                    <div class="value" id="totalPlayers">-</div>
                </div>
                <div class="stat-card">
                    <h3>å‚åŠ å­¦æ ¡æ•°</h3>
                    <div class="value" id="totalSchools">-</div>
                </div>
                <div class="stat-card">
                    <h3>ãƒ€ãƒ–ãƒ«ã‚¹çµ„æ•°</h3>
                    <div class="value" id="totalPairs">-</div>
                </div>
            </div>

            <div class="form-section">
                <h3>ç¨®ç›®åˆ¥é›†è¨ˆ</h3>
                <div id="categoryStats">
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>å­¦æ ¡åˆ¥é›†è¨ˆ</h3>
                <div id="schoolStats">
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
                    </div>
                </div>
            </div>

            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“‹ ç™»éŒ²è€…ä¸€è¦§</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å­¦æ ¡å</th>
                            <th>ç¨®ç›®</th>
                            <th>é¸æ‰‹å</th>
                            <th>å­¦å¹´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="playerList">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #6c757d;">
                                ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ã‚¿ãƒ–3: ç®¡ç†ãƒ»å‡ºåŠ› -->
        <div class="tab-content">
            <div class="admin-section">
                <h3>ğŸ” ç®¡ç†è€…èªè¨¼</h3>
                <div class="password-input">
                    <input type="password" id="adminPassword" placeholder="ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
                    <button class="btn btn-primary" onclick="adminLogin()" style="flex: 0 0 120px;">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </div>
                <p style="font-size: 12px; color: #856404;">â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <strong>badminton2024</strong></p>
            </div>

            <div id="adminPanel" class="hidden">
                <div class="form-section">
                    <h3>ğŸ“¥ ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</h3>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="exportAllCSV()">
                            ğŸ“„ å…¨ãƒ‡ãƒ¼ã‚¿CSVå‡ºåŠ›
                        </button>
                        <button class="btn btn-success" onclick="exportByCategoryCSV()">
                            ğŸ“Š ç¨®ç›®åˆ¥CSVå‡ºåŠ›
                        </button>
                    </div>
                </div>

                <div class="form-section">
                    <h3>ğŸ“¤ Phase 2é€£æº</h3>
                    <p style="margin-bottom: 15px; color: #495057;">
                        Phase 2ï¼ˆçµ„ã¿åˆã‚ã›ä½œæˆï¼‰ã§ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
                    </p>
                    <button class="btn btn-primary" onclick="exportForPhase2()">
                        ğŸš€ Phase 2ç”¨ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
                    </button>
                </div>

                <div class="form-section">
                    <h3>ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                    <button class="btn btn-secondary" onclick="confirmClearAll()">
                        âš« å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
                    </button>
                    <p style="font-size: 12px; color: #6c757d; margin-top: 10px;">
                        âš ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚æ…é‡ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // è¨­å®š
        // ============================================
        // â€»â€»â€» é‡è¦ â€»â€»â€»
        // Google Apps Scriptã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå¾Œã€ä»¥ä¸‹ã®URLã‚’æ›´æ–°ã—ã¦ãã ã•ã„
        // 1. Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ç®¡ç†ã€
        // 2. ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’ã‚³ãƒ”ãƒ¼
        // 3. ä»¥ä¸‹ã®SCRIPT_URLã«è²¼ã‚Šä»˜ã‘
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKZJXoe4vVMjczJRB7jBDSZqxU7U3BjEcT8I2s-vkDTfXJrOZSSYr3mf7K5bJKnPan/exec';

        // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹
        let isAdminLoggedIn = false;

        // ============================================
        // åˆæœŸåŒ–
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeSelectOptions();
            loadData();
        });

        // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹åˆæœŸåŒ–
        function initializeSelectOptions() {
            const selects = ['msCount', 'wsCount', 'mdCount', 'wdCount'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                for (let i = 1; i <= 100; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    select.appendChild(option);
                }
            });
        }

        // ============================================
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        // ============================================
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            tabs[index].classList.add('active');
            contents[index].classList.add('active');

            if (index === 1) {
                loadData();
            }
        }

        // å­¦æ ¡åã‚µã‚¸ã‚§ã‚¹ãƒˆã¯å‰Šé™¤ï¼ˆä¸è¦ï¼‰

        // ============================================
        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‹•çš„ç”Ÿæˆ
        // ============================================
        function generateFields() {
            const container = document.getElementById('entryFieldsContainer');
            container.innerHTML = '';

            const categories = [
                { id: 'msCount', name: 'ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹', type: 'singles', color: '#0066cc' },
                { id: 'wsCount', name: 'å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹', type: 'singles', color: '#cc0066' },
                { id: 'mdCount', name: 'ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹', type: 'doubles', color: '#0066cc' },
                { id: 'wdCount', name: 'å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹', type: 'doubles', color: '#cc0066' }
            ];

            categories.forEach(cat => {
                const count = parseInt(document.getElementById(cat.id).value);
                if (count > 0) {
                    const section = createCategorySection(cat, count);
                    container.appendChild(section);
                }
            });
        }

        function createCategorySection(category, count) {
            const section = document.createElement('div');
            section.className = 'form-section';
            
            const header = document.createElement('h3');
            header.textContent = `${category.name}ï¼ˆ${count}${category.type === 'singles' ? 'äºº' : 'çµ„'}ï¼‰`;
            header.style.borderLeft = `4px solid ${category.color}`;
            header.style.paddingLeft = '10px';
            section.appendChild(header);

            for (let i = 0; i < count; i++) {
                if (category.type === 'singles') {
                    section.appendChild(createSinglesEntry(category.id, i + 1));
                } else {
                    section.appendChild(createDoublesEntry(category.id, i + 1));
                }
            }

            return section;
        }

        function createSinglesEntry(categoryId, index) {
            const group = document.createElement('div');
            group.className = 'entry-group';
            group.innerHTML = `
                <div class="entry-header">å‚åŠ è€… ${index}</div>
                <div class="form-group">
                    <label>æ°å<span class="required">*</span></label>
                    <input type="text" class="player-name" data-category="${categoryId}" data-index="${index}" placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
                </div>
                <div class="form-group">
                    <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
                    <input type="text" class="player-kana" data-category="${categoryId}" data-index="${index}" placeholder="ä¾‹: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦">
                </div>
                <div class="form-group">
                    <label>å­¦å¹´<span class="required">*</span></label>
                    <select class="player-grade" data-category="${categoryId}" data-index="${index}">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="1å¹´">1å¹´</option>
                        <option value="2å¹´">2å¹´</option>
                        <option value="3å¹´">3å¹´</option>
                    </select>
                </div>
            `;
            return group;
        }

        function createDoublesEntry(categoryId, index) {
            const group = document.createElement('div');
            group.className = 'entry-group';
            group.innerHTML = `
                <div class="entry-header">ãƒšã‚¢ ${index}</div>
                
                <div class="pair-section">
                    <h5>ğŸ‘¤ ãƒšã‚¢A</h5>
                    <div class="form-group">
                        <label>æ°å<span class="required">*</span></label>
                        <input type="text" class="pair-a-name" data-category="${categoryId}" data-index="${index}" placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
                        <input type="text" class="pair-a-kana" data-category="${categoryId}" data-index="${index}" placeholder="ä¾‹: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦">
                    </div>
                    <div class="form-group">
                        <label>å­¦å¹´<span class="required">*</span></label>
                        <select class="pair-a-grade" data-category="${categoryId}" data-index="${index}">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="1å¹´">1å¹´</option>
                            <option value="2å¹´">2å¹´</option>
                            <option value="3å¹´">3å¹´</option>
                        </select>
                    </div>
                </div>

                <div class="pair-section">
                    <h5>ğŸ‘¤ ãƒšã‚¢B</h5>
                    <div class="form-group">
                        <label>æ°å<span class="required">*</span></label>
                        <input type="text" class="pair-b-name" data-category="${categoryId}" data-index="${index}" placeholder="ä¾‹: ä½è—¤èŠ±å­">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
                        <input type="text" class="pair-b-kana" data-category="${categoryId}" data-index="${index}" placeholder="ä¾‹: ã‚µãƒˆã‚¦ãƒãƒŠã‚³">
                    </div>
                    <div class="form-group">
                        <label>å­¦å¹´<span class="required">*</span></label>
                        <select class="pair-b-grade" data-category="${categoryId}" data-index="${index}">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="1å¹´">1å¹´</option>
                            <option value="2å¹´">2å¹´</option>
                            <option value="3å¹´">3å¹´</option>
                        </select>
                    </div>
                </div>
            `;
            return group;
        }

        // ============================================
        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        // ============================================
        async function submitForm() {
            if (!validateForm()) return;

            const data = collectFormData();
            
            // ãƒ‡ãƒãƒƒã‚°ï¼šcollectFormDataã®çµæœã‚’å‡ºåŠ›
            console.log('=== collectFormDataçµæœ ===');
            console.log('schoolName:', data.schoolName);
            console.log('schoolAddress:', data.schoolAddress);
            console.log('contactName:', data.contactName);
            console.log('contactEmail:', data.contactEmail);
            console.log('contactPhone:', data.contactPhone);
            console.log('entries:', data.entries);
            console.log('========================');
            const submitBtn = document.getElementById('submitBtn');
            
            // ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
            submitBtn.disabled = true;
            showAlert('info', 'é€ä¿¡ä¸­...ãŠå¾…ã¡ãã ã•ã„');

            try {
                const formData = new FormData();
                formData.append('action', 'register');
                formData.append('schoolName', data.schoolName);
                formData.append('address', data.schoolAddress || '');
                formData.append('representative', data.contactName);
                formData.append('email', data.contactEmail);
                formData.append('phone', data.contactPhone || '');
                
                // ç¨®ç›®åˆ¥å‡ºå ´æ•°
                formData.append('BS', data.entries.filter(e => e.category === 'BS').length);
                formData.append('GS', data.entries.filter(e => e.category === 'GS').length);
                formData.append('BD', data.entries.filter(e => e.category === 'BD').length);
                formData.append('GD', data.entries.filter(e => e.category === 'GD').length);
                
                // é¸æ‰‹æƒ…å ±
                const categoryCounts = { BS: 0, GS: 0, BD: 0, GD: 0 };
                data.entries.forEach(entry => {
                    categoryCounts[entry.category]++;
                    const index = categoryCounts[entry.category];
                    
                    formData.append(`${entry.category}_${index}_player1_name`, entry.player1Name);
                    formData.append(`${entry.category}_${index}_player1_kana`, entry.player1Kana);
                    formData.append(`${entry.category}_${index}_player1_grade`, entry.player1Grade);
                    
                    if (entry.category === 'BD' || entry.category === 'GD') {
                        formData.append(`${entry.category}_${index}_player2_name`, entry.player2Name || '');
                        formData.append(`${entry.category}_${index}_player2_kana`, entry.player2Kana || '');
                        formData.append(`${entry.category}_${index}_player2_grade`, entry.player2Grade || '');
                    }
                });
                
                // ãƒ‡ãƒãƒƒã‚°ï¼šFormDataã®å†…å®¹ã‚’å‡ºåŠ›
                console.log('=== FormDataé€ä¿¡å†…å®¹ ===');
                for (let pair of formData.entries()) {
                    console.log(pair[0] + ': ' + pair[1]);
                }
                console.log('========================');

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', 'âœ… ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                    clearForm();
                    
                    // 3ç§’å¾Œã«ç™»éŒ²çŠ¶æ³ã‚¿ãƒ–ã«ç§»å‹•
                    setTimeout(() => {
                        switchTab(1);
                    }, 3000);
                } else {
                    showAlert('error', 'âŒ ' + (result.message || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                }
                
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                submitBtn.disabled = false;
            }
        }

        function validateForm() {
            const schoolName = document.getElementById('schoolName').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();

            if (!schoolName) {
                showAlert('error', 'âŒ å­¦æ ¡åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return false;
            }

            if (!contactName) {
                showAlert('error', 'âŒ ä»£è¡¨è€…æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return false;
            }

            if (!contactEmail) {
                showAlert('error', 'âŒ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return false;
            }

            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(contactEmail)) {
                showAlert('error', 'âŒ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                return false;
            }

            // ç¨®ç›®ãŒ1ã¤ã‚‚é¸æŠã•ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
            const msCount = parseInt(document.getElementById('msCount').value);
            const wsCount = parseInt(document.getElementById('wsCount').value);
            const mdCount = parseInt(document.getElementById('mdCount').value);
            const wdCount = parseInt(document.getElementById('wdCount').value);

            if (msCount + wsCount + mdCount + wdCount === 0) {
                showAlert('error', 'âŒ å°‘ãªãã¨ã‚‚1ã¤ã®ç¨®ç›®ã§å‡ºå ´æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return false;
            }

            // å…¥åŠ›æ¬„ã®å¿…é ˆãƒã‚§ãƒƒã‚¯
            const allInputs = document.querySelectorAll('#entryFieldsContainer input[type="text"], #entryFieldsContainer select');
            for (let input of allInputs) {
                if (!input.value.trim()) {
                    showAlert('error', 'âŒ ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    input.focus();
                    return false;
                }
            }

            return true;
        }

        function collectFormData() {
            const schoolName = document.getElementById('schoolName').value.trim();
            const schoolAddress = document.getElementById('address').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            const contactEmail = document.getElementById('contactEmail').value.trim();
            const contactPhone = document.getElementById('contactPhone').value.trim();

            const entries = [];

            // ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹
            const msCount = parseInt(document.getElementById('msCount').value);
            for (let i = 1; i <= msCount; i++) {
                const name = document.querySelector(`.player-name[data-category="msCount"][data-index="${i}"]`).value;
                const kana = document.querySelector(`.player-kana[data-category="msCount"][data-index="${i}"]`).value;
                const grade = document.querySelector(`.player-grade[data-category="msCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'BS',
                    player1Name: name,
                    player1Kana: kana,
                    player1Grade: grade,
                    player2Name: '',
                    player2Kana: '',
                    player2Grade: ''
                });
            }

            // å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹
            const wsCount = parseInt(document.getElementById('wsCount').value);
            for (let i = 1; i <= wsCount; i++) {
                const name = document.querySelector(`.player-name[data-category="wsCount"][data-index="${i}"]`).value;
                const kana = document.querySelector(`.player-kana[data-category="wsCount"][data-index="${i}"]`).value;
                const grade = document.querySelector(`.player-grade[data-category="wsCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'GS',
                    player1Name: name,
                    player1Kana: kana,
                    player1Grade: grade,
                    player2Name: '',
                    player2Kana: '',
                    player2Grade: ''
                });
            }

            // ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹
            const mdCount = parseInt(document.getElementById('mdCount').value);
            for (let i = 1; i <= mdCount; i++) {
                const nameA = document.querySelector(`.pair-a-name[data-category="mdCount"][data-index="${i}"]`).value;
                const kanaA = document.querySelector(`.pair-a-kana[data-category="mdCount"][data-index="${i}"]`).value;
                const gradeA = document.querySelector(`.pair-a-grade[data-category="mdCount"][data-index="${i}"]`).value;
                const nameB = document.querySelector(`.pair-b-name[data-category="mdCount"][data-index="${i}"]`).value;
                const kanaB = document.querySelector(`.pair-b-kana[data-category="mdCount"][data-index="${i}"]`).value;
                const gradeB = document.querySelector(`.pair-b-grade[data-category="mdCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'BD',
                    player1Name: nameA,
                    player1Kana: kanaA,
                    player1Grade: gradeA,
                    player2Name: nameB,
                    player2Kana: kanaB,
                    player2Grade: gradeB
                });
            }

            // å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹
            const wdCount = parseInt(document.getElementById('wdCount').value);
            for (let i = 1; i <= wdCount; i++) {
                const nameA = document.querySelector(`.pair-a-name[data-category="wdCount"][data-index="${i}"]`).value;
                const kanaA = document.querySelector(`.pair-a-kana[data-category="wdCount"][data-index="${i}"]`).value;
                const gradeA = document.querySelector(`.pair-a-grade[data-category="wdCount"][data-index="${i}"]`).value;
                const nameB = document.querySelector(`.pair-b-name[data-category="wdCount"][data-index="${i}"]`).value;
                const kanaB = document.querySelector(`.pair-b-kana[data-category="wdCount"][data-index="${i}"]`).value;
                const gradeB = document.querySelector(`.pair-b-grade[data-category="wdCount"][data-index="${i}"]`).value;
                
                entries.push({
                    category: 'GD',
                    player1Name: nameA,
                    player1Kana: kanaA,
                    player1Grade: gradeA,
                    player2Name: nameB,
                    player2Kana: kanaB,
                    player2Grade: gradeB
                });
            }

            return {
                schoolName,
                schoolAddress,
                contactName,
                contactEmail,
                contactPhone,
                entries
            };
        }

        function clearForm() {
            document.getElementById('schoolName').value = '';
            document.getElementById('address').value = '';
            document.getElementById('contactName').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactPhone').value = '';
            
            document.getElementById('msCount').value = '0';
            document.getElementById('wsCount').value = '0';
            document.getElementById('mdCount').value = '0';
            document.getElementById('wdCount').value = '0';
            
            document.getElementById('entryFieldsContainer').innerHTML = '';
        }

        // ============================================
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        // ============================================
        async function loadData() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData', {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                if (!response.ok) {
                    throw new Error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ' + response.status);
                }
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Apps Scriptã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ä½¿ç”¨
                    const players = result.data.players || [];
                    const schools = result.data.schools || [];
                    
                    console.log('Players:', players);
                    console.log('Schools:', schools);
                    
                    updateStats(players, schools);
                    updatePlayerList(players);
                } else {
                    console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:', result.message);
                    updateStatsEmpty();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                updateStatsEmpty();
            }
        }

        function updateStatsEmpty() {
            document.getElementById('totalPlayers').textContent = '0';
            document.getElementById('totalSchools').textContent = '0';
            document.getElementById('totalPairs').textContent = '0';
            document.getElementById('categoryStats').innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            document.getElementById('schoolStats').innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            document.getElementById('playerList').innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
        }

        function updateStats(players, schools) {
            if (!players || players.length === 0) {
                updateStatsEmpty();
                return;
            }

            const totalPlayers = players.length;
            const uniqueSchools = new Set(players.map(p => p.schoolName));
            const pairs = players.filter(p => p.category === 'BD' || p.category === 'GD').length;

            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('totalSchools').textContent = uniqueSchools.size;
            document.getElementById('totalPairs').textContent = pairs;

            // ç¨®ç›®åˆ¥é›†è¨ˆ
            const categoryCount = { 'BS': 0, 'GS': 0, 'BD': 0, 'GD': 0 };
            players.forEach(p => {
                if (p.category && categoryCount.hasOwnProperty(p.category)) {
                    categoryCount[p.category]++;
                }
            });
            
            const categoryNames = {
                'BS': 'ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹',
                'GS': 'å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹',
                'BD': 'ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹',
                'GD': 'å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹'
            };

            const categoryStatsHTML = Object.entries(categoryCount)
                .filter(([cat, count]) => count > 0)
                .map(([cat, count]) => `
                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; margin: 5px 0; border-radius: 5px;">
                    <span>${categoryNames[cat]}</span>
                    <strong style="color: #667eea;">${count}${cat === 'BD' || cat === 'GD' ? 'çµ„' : 'äºº'}</strong>
                </div>
            `).join('');
            document.getElementById('categoryStats').innerHTML = categoryStatsHTML || '<div style="text-align: center; color: #6c757d; padding: 20px;">ãƒ‡ãƒ¼ã‚¿ãªã—</div>';

            // å­¦æ ¡åˆ¥é›†è¨ˆ
            const schoolCount = {};
            players.forEach(p => {
                if (p.schoolName) {
                    schoolCount[p.schoolName] = (schoolCount[p.schoolName] || 0) + 1;
                }
            });

            const schoolStatsHTML = Object.entries(schoolCount).map(([school, count]) => `
                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; margin: 5px 0; border-radius: 5px;">
                    <span>${school}</span>
                    <strong style="color: #667eea;">${count}äºº</strong>
                </div>
            `).join('');
            document.getElementById('schoolStats').innerHTML = schoolStatsHTML || '<div style="text-align: center; color: #6c757d; padding: 20px;">ãƒ‡ãƒ¼ã‚¿ãªã—</div>';
        }

        function updatePlayerList(data) {
            const tbody = document.getElementById('playerList');
            
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #6c757d;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            tbody.innerHTML = data.map((player, index) => {
                const isDoubles = player.category === 'BD' || player.category === 'GD';
                const categoryNames = {
                    'BS': 'ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹',
                    'GS': 'å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹',
                    'BD': 'ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹',
                    'GD': 'å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹'
                };
                const playerName = isDoubles
                    ? `<strong>ãƒšã‚¢A:</strong> ${player.player1Name || '-'}ï¼ˆ${player.player1Grade || '-'}ï¼‰<br><strong>ãƒšã‚¢B:</strong> ${player.player2Name || '-'}ï¼ˆ${player.player2Grade || '-'}ï¼‰`
                    : player.player1Name || '-';
                const grade = isDoubles ? '-' : (player.player1Grade || '-');

                // å‰Šé™¤ãƒœã‚¿ãƒ³ã¯ç®¡ç†è€…ã®ã¿è¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ï¼‰
                const timestampStr = player.timestamp ? new Date(player.timestamp).toISOString() : '';
                const deleteButton = isAdminLoggedIn 
                    ? `<button class="btn-small btn-delete" onclick="deletePlayer('${timestampStr}', '${player.schoolName}', '${player.player1Name}')">å‰Šé™¤</button>`
                    : '-';

                return `
                    <tr>
                        <td>${player.schoolName || '-'}</td>
                        <td>${categoryNames[player.category] || player.category || '-'}</td>
                        <td>${playerName}</td>
                        <td>${grade}</td>
                        <td>${deleteButton}</td>
                    </tr>
                `;
            }).join('');
        }

        async function deletePlayer(timestamp, schoolName, player1Name) {
            if (!isAdminLoggedIn) {
                showAlert('error', 'âŒ ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™');
                return;
            }

            if (!confirm('ã“ã®ç™»éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nå­¦æ ¡ï¼š' + schoolName + '\né¸æ‰‹ï¼š' + player1Name + '\n\nâ€»ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;

            try {
                const formData = new FormData();
                formData.append('action', 'deletePlayer');
                formData.append('timestamp', timestamp);
                formData.append('schoolName', schoolName);
                formData.append('player1Name', player1Name);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', 'âœ… å‰Šé™¤ã—ã¾ã—ãŸ');
                    loadData();
                } else {
                    showAlert('error', 'âŒ ' + (result.message || 'å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ============================================
        // ç®¡ç†æ©Ÿèƒ½
        // ============================================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'badminton2024') {
                isAdminLoggedIn = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                showAlert('success', 'âœ… ç®¡ç†è€…èªè¨¼æˆåŠŸ');
                // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚å†èª­ã¿è¾¼ã¿
                loadData();
            } else {
                showAlert('error', 'âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
            }
        }

        function exportAllCSV() {
            window.open(SCRIPT_URL + '?action=exportCSV', '_blank');
        }

        function exportByCategoryCSV() {
            const category = prompt('ç¨®ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š\nBS: ç”·å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹\nGS: å¥³å­ã‚·ãƒ³ã‚°ãƒ«ã‚¹\nBD: ç”·å­ãƒ€ãƒ–ãƒ«ã‚¹\nGD: å¥³å­ãƒ€ãƒ–ãƒ«ã‚¹', 'BS');
            
            if (category && ['BS', 'GS', 'BD', 'GD'].includes(category.toUpperCase())) {
                window.open(SCRIPT_URL + '?action=exportByCategory&category=' + category.toUpperCase(), '_blank');
            } else if (category) {
                alert('æœ‰åŠ¹ãªç¨®ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼šBS, GS, BD, GD');
            }
        }

        function exportForPhase2() {
            window.open(SCRIPT_URL + '?action=exportForPhase2', '_blank');
        }

        async function confirmClearAll() {
            if (!confirm('âš ï¸ æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) return;
            
            const password = prompt('ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (password !== 'badminton2024') {
                showAlert('error', 'âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('action', 'clearAll');
                formData.append('password', password);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ' + response.status);
                }

                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', 'âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
                    loadData();
                } else {
                    showAlert('error', 'âŒ ' + (result.message || 'ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ============================================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        // ============================================
        function showAlert(type, message) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.className = `alert alert-${type} show`;
            alertDiv.textContent = message;
            
            // è‡ªå‹•çš„ã«æ¶ˆãˆã‚‹
            setTimeout(() => {
                alertDiv.classList.remove('show');
            }, 5000);

            // ç”»é¢æœ€ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ã‚¯ãƒªãƒƒã‚¯ã§ã‚µã‚¸ã‚§ã‚¹ãƒˆé–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#schoolName')) {
                document.getElementById('schoolSuggestions')?.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
