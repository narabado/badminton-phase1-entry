<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éê„Éâ„Éü„É≥„Éà„É≥Â§ß‰ºö Âá∫Â†¥ËÄÖÁôªÈå≤„Ç∑„Çπ„ÉÜ„É† - Phase 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            color: #495057;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Áµ±Ë®à„Ç´„Éº„Éâ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 1.1em;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 3.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* „Éï„Ç©„Éº„É†„Çπ„Çø„Ç§„É´ */
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .form-section h2::before {
            content: 'üìù';
            margin-right: 15px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
            font-size: 1em;
        }

        .form-group label .required {
            color: #dc3545;
            margin-left: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .pair-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .pair-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        /* „Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 18px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 12px 24px;
            font-size: 1em;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            font-size: 1em;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
            padding: 12px 24px;
            font-size: 1em;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        /* „ÉÜ„Éº„Éñ„É´„Çπ„Çø„Ç§„É´ */
        .data-section {
            margin-top: 30px;
        }

        .data-section h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            font-size: 0.9em;
        }

        tbody tr {
            transition: background 0.3s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
            font-size: 1.1em;
        }

        /* ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥„Çª„ÇØ„Ç∑„Éß„É≥ */
        .admin-login {
            max-width: 500px;
            margin: 0 auto;
        }

        .admin-login h2 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-align: center;
        }

        .admin-login .form-group {
            margin-bottom: 25px;
        }

        .admin-login input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1em;
        }

        .admin-login .btn {
            width: 100%;
            padding: 18px;
            font-size: 1.1em;
        }

        /* ÁÆ°ÁêÜ„É°„Éã„É•„Éº */
        .admin-menu {
            background: #fff3cd;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* „Ç¢„É©„Éº„Éà */
        .alert {
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-size: 1em;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .tab {
                font-size: 0.9em;
                padding: 15px 10px;
            }

            .stat-card .number {
                font-size: 2.5em;
            }

            th, td {
                font-size: 0.85em;
                padding: 10px 8px;
            }

            .button-group {
                flex-direction: column;
            }

            .admin-menu {
                flex-direction: column;
            }
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Çπ„Éî„Éä„Éº */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∏ „Éê„Éâ„Éü„É≥„Éà„É≥Â§ß‰ºö Âá∫Â†¥ËÄÖÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†</h1>
            <p>Phase 1: Âá∫Â†¥ËÄÖÁôªÈå≤„Éª„Éá„Éº„ÇøÁÆ°ÁêÜ</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('entry')">üìã Âá∫Â†¥ËÄÖÁôªÈå≤</button>
            <button class="tab" onclick="switchTab('list')">üìä ÁôªÈå≤Áä∂Ê≥Å</button>
            <button class="tab" onclick="switchTab('admin')">‚öôÔ∏è ÁÆ°ÁêÜ</button>
        </div>

        <!-- Tab 1: Âá∫Â†¥ËÄÖÁôªÈå≤ -->
        <div id="entry-tab" class="tab-content active">
            <div class="stats-container">
                <div class="stat-card">
                    <h3>ÂèÇÂä†Â≠¶Ê†°Êï∞</h3>
                    <div class="number" id="stat-schools">0</div>
                </div>
                <div class="stat-card">
                    <h3>ÁèæÂú®„Ç®„É≥„Éà„É™„ÉºÊï∞</h3>
                    <div class="number" id="stat-current">0</div>
                </div>
                <div class="stat-card">
                    <h3>Êñ∞„Ç®„É≥„Éà„É™„ÉºÊï∞</h3>
                    <div class="number" id="stat-new">0</div>
                </div>
            </div>

            <div class="form-section">
                <h2>Êñ∞Ë¶è„Ç®„É≥„Éà„É™„ÉºÁôªÈå≤</h2>
                
                <div class="form-group">
                    <label>Â≠¶Ê†°Âêç<span class="required">*</span></label>
                    <input type="text" id="schoolName" placeholder="‰æã: Êú≠ÂπåË•øÂêà" required>
                </div>

                <div class="form-group">
                    <label>Á®ÆÁõÆ<span class="required">*</span></label>
                    <select id="category" required onchange="handleCategoryChange()">
                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        <option value="Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ">Áî∑Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ</option>
                        <option value="Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ">Â•≥Â≠ê„Ç∑„É≥„Ç∞„É´„Çπ</option>
                        <option value="Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ">Áî∑Â≠ê„ÉÄ„Éñ„É´„Çπ</option>
                        <option value="Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ">Â•≥Â≠ê„ÉÄ„Éñ„É´„Çπ</option>
                        <option value="Ê∑∑Âêà„ÉÄ„Éñ„É´„Çπ">Ê∑∑Âêà„ÉÄ„Éñ„É´„Çπ</option>
                    </select>
                </div>

                <div id="singles-form" style="display: none;">
                    <div class="form-group">
                        <label>ÈÅ∏ÊâãÂêç<span class="required">*</span></label>
                        <input type="text" id="player1Name-single" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                    </div>
                    <div class="form-group">
                        <label>„Éï„É™„Ç¨„Éä<span class="required">*</span></label>
                        <input type="text" id="player1Furigana-single" placeholder="‰æã: „É§„Éû„ÉÄ„Çø„É≠„Ç¶">
                    </div>
                    <div class="form-group">
                        <label>Â≠¶Âπ¥<span class="required">*</span></label>
                        <select id="player1Grade-single">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="1Âπ¥">1Âπ¥</option>
                            <option value="2Âπ¥">2Âπ¥</option>
                            <option value="3Âπ¥">3Âπ¥</option>
                        </select>
                    </div>
                </div>

                <div id="doubles-form" style="display: none;">
                    <div class="pair-section">
                        <h3>üë§ „Éö„Ç¢1</h3>
                        <div class="form-group">
                            <label>ÈÅ∏ÊâãÂêç<span class="required">*</span></label>
                            <input type="text" id="player1Name-double" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                        </div>
                        <div class="form-group">
                            <label>„Éï„É™„Ç¨„Éä<span class="required">*</span></label>
                            <input type="text" id="player1Furigana-double" placeholder="‰æã: „É§„Éû„ÉÄ„Çø„É≠„Ç¶">
                        </div>
                        <div class="form-group">
                            <label>Â≠¶Âπ¥<span class="required">*</span></label>
                            <select id="player1Grade-double">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="1Âπ¥">1Âπ¥</option>
                                <option value="2Âπ¥">2Âπ¥</option>
                                <option value="3Âπ¥">3Âπ¥</option>
                            </select>
                        </div>
                    </div>

                    <div class="pair-section">
                        <h3>üë§ „Éö„Ç¢2</h3>
                        <div class="form-group">
                            <label>ÈÅ∏ÊâãÂêç<span class="required">*</span></label>
                            <input type="text" id="player2Name" placeholder="‰æã: ‰ΩêËó§Ëä±Â≠ê">
                        </div>
                        <div class="form-group">
                            <label>„Éï„É™„Ç¨„Éä<span class="required">*</span></label>
                            <input type="text" id="player2Furigana" placeholder="‰æã: „Çµ„Éà„Ç¶„Éè„Éä„Ç≥">
                        </div>
                        <div class="form-group">
                            <label>Â≠¶Âπ¥<span class="required">*</span></label>
                            <select id="player2Grade">
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="1Âπ¥">1Âπ¥</option>
                                <option value="2Âπ¥">2Âπ¥</option>
                                <option value="3Âπ¥">3Âπ¥</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="submitEntry()">‚úÖ ÁôªÈå≤„Åô„Çã</button>
                    <button class="btn btn-secondary" onclick="clearForm()">üîÑ „ÇØ„É™„Ç¢</button>
                </div>
            </div>
        </div>

        <!-- Tab 2: ÁôªÈå≤Áä∂Ê≥Å -->
        <div id="list-tab" class="tab-content">
            <div class="data-section">
                <h2>üìã Á®ÆÁõÆÂà•ÈõÜË®à</h2>
                <div id="category-stats" class="table-container">
                    <div class="no-data">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                </div>
            </div>

            <div class="data-section">
                <h2>üìä ÂÖ®‰ΩìÈõÜË®à (ÂÖ®„Ç´„ÉÜ„Ç¥„É™„Éº)</h2>
                <div id="overall-list" class="table-container">
                    <div class="no-data">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                </div>
            </div>

            <div class="data-section">
                <h2>üè´ Â≠¶Ê†°Âà•ÈõÜË®à</h2>
                <div id="school-stats" class="table-container">
                    <div class="no-data">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                </div>
            </div>
        </div>

        <!-- Tab 3: ÁÆ°ÁêÜ -->
        <div id="admin-tab" class="tab-content">
            <div id="admin-login-section" class="admin-login">
                <h2>üîê ÁÆ°ÁêÜËÄÖË™çË®º</h2>
                <div class="form-group">
                    <label>„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="adminPassword" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                </div>
                <button class="btn btn-primary" onclick="adminLogin()">üîì „É≠„Ç∞„Ç§„É≥</button>
            </div>

            <div id="admin-panel" style="display: none;">
                <div class="admin-menu">
                    <button class="btn btn-primary" onclick="showActiveEntries()">üìã ÈÅ∏Êâã‰∏ÄË¶ß„ÇíË¶ã„Çã (ÂÄãÂà•ÂâäÈô§)</button>
                    <button class="btn btn-secondary" onclick="exportData()">üíæ „Éá„Éº„Çø„ÇØ„É™„Ç¢</button>
                </div>

                <div class="data-section">
                    <h2>üìã ÂâäÈô§Ê∏à„ÅøÈÅ∏Êâã</h2>
                    <div id="deleted-list" class="table-container">
                        <div class="spinner"></div>
                    </div>
                </div>

                <div class="data-section" id="active-entries-section" style="display: none;">
                    <h2>üìã ÁèæÂú®„ÅÆÈÅ∏Êâã‰∏ÄË¶ß</h2>
                    <div id="active-list" class="table-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKZJXoe4vVMjczJRB7jBDSZqxU7U3BjEcT8I2s-vkDTfXJrOZSSYr3mf7K5bJKnPan/exec';
        const ADMIN_PASSWORD = 'badminton2024';

        let allData = [];
        let deletedData = [];

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'entry') {
                loadStats();
            } else if (tabName === 'list') {
                loadData();
            }
        }

        // Áµ±Ë®à„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadStats() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getStats');
                const result = await response.json();
                
                console.log('‚ñ†‚ñ† „Éá„Éº„ÇøÂèñÂæó„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± ‚ñ†‚ñ†');
                console.log('API „É¨„Çπ„Éù„É≥„ÇπÂÖ®‰Ωì:', result);
                
                if (result.success) {
                    document.getElementById('stat-schools').textContent = result.data.totalSchools;
                    document.getElementById('stat-current').textContent = result.data.totalEntries;
                    document.getElementById('stat-new').textContent = result.data.newEntries;
                } else {
                    console.error('„Éá„Éº„ÇøÂèñÂæóÂ§±Êïó:', result.message);
                }
            } catch (error) {
                console.error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
            }
        }

        // „Ç´„ÉÜ„Ç¥„É™„ÉºÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        function handleCategoryChange() {
            const category = document.getElementById('category').value;
            const singlesForm = document.getElementById('singles-form');
            const doublesForm = document.getElementById('doubles-form');

            if (category.includes('„Ç∑„É≥„Ç∞„É´„Çπ')) {
                singlesForm.style.display = 'block';
                doublesForm.style.display = 'none';
            } else if (category.includes('„ÉÄ„Éñ„É´„Çπ')) {
                singlesForm.style.display = 'none';
                doublesForm.style.display = 'block';
            } else {
                singlesForm.style.display = 'none';
                doublesForm.style.display = 'none';
            }
        }

        // „Ç®„É≥„Éà„É™„ÉºÈÄÅ‰ø°
        async function submitEntry() {
            const schoolName = document.getElementById('schoolName').value;
            const category = document.getElementById('category').value;

            if (!schoolName || !category) {
                showAlert('Â≠¶Ê†°Âêç„Å®Á®ÆÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const isSingles = category.includes('„Ç∑„É≥„Ç∞„É´„Çπ');
            let formData = new FormData();
            formData.append('action', 'addEntry');
            formData.append('schoolName', schoolName);
            formData.append('category', category);
            formData.append('isSingles', isSingles);

            if (isSingles) {
                const player1Name = document.getElementById('player1Name-single').value;
                const player1Furigana = document.getElementById('player1Furigana-single').value;
                const player1Grade = document.getElementById('player1Grade-single').value;

                if (!player1Name || !player1Furigana || !player1Grade) {
                    showAlert('„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    return;
                }

                formData.append('player1Name', player1Name);
                formData.append('player1Furigana', player1Furigana);
                formData.append('player1Grade', player1Grade);
            } else {
                const player1Name = document.getElementById('player1Name-double').value;
                const player1Furigana = document.getElementById('player1Furigana-double').value;
                const player1Grade = document.getElementById('player1Grade-double').value;
                const player2Name = document.getElementById('player2Name').value;
                const player2Furigana = document.getElementById('player2Furigana').value;
                const player2Grade = document.getElementById('player2Grade').value;

                if (!player1Name || !player1Furigana || !player1Grade || 
                    !player2Name || !player2Furigana || !player2Grade) {
                    showAlert('„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    return;
                }

                formData.append('player1Name', player1Name);
                formData.append('player1Furigana', player1Furigana);
                formData.append('player1Grade', player1Grade);
                formData.append('player2Name', player2Name);
                formData.append('player2Furigana', player2Furigana);
                formData.append('player2Grade', player2Grade);
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ ÁôªÈå≤ÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
                    clearForm();
                    loadStats();
                } else {
                    showAlert('‚ùå ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error, 'error');
            }
        }

        // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
        function clearForm() {
            document.getElementById('schoolName').value = '';
            document.getElementById('category').value = '';
            document.getElementById('singles-form').style.display = 'none';
            document.getElementById('doubles-form').style.display = 'none';
            
            // „Ç∑„É≥„Ç∞„É´„Çπ„Éï„Ç©„Éº„É†
            document.getElementById('player1Name-single').value = '';
            document.getElementById('player1Furigana-single').value = '';
            document.getElementById('player1Grade-single').value = '';
            
            // „ÉÄ„Éñ„É´„Çπ„Éï„Ç©„Éº„É†
            document.getElementById('player1Name-double').value = '';
            document.getElementById('player1Furigana-double').value = '';
            document.getElementById('player1Grade-double').value = '';
            document.getElementById('player2Name').value = '';
            document.getElementById('player2Furigana').value = '';
            document.getElementById('player2Grade').value = '';
        }

        // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadData() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData');
                const result = await response.json();

                if (result.success) {
                    allData = result.data;
                    displayCategoryStats();
                    displayOverallList();
                    displaySchoolStats();
                } else {
                    showAlert('„Éá„Éº„ÇøÂèñÂæóÂ§±Êïó: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº: ' + error, 'error');
            }
        }

        // Á®ÆÁõÆÂà•ÈõÜË®àË°®Á§∫
        function displayCategoryStats() {
            const categories = {};
            allData.forEach(entry => {
                if (!categories[entry.category]) {
                    categories[entry.category] = 0;
                }
                categories[entry.category]++;
            });

            let html = '<table><thead><tr><th>Á®ÆÁõÆ</th><th>„Ç®„É≥„Éà„É™„ÉºÊï∞</th></tr></thead><tbody>';
            Object.keys(categories).sort().forEach(cat => {
                html += `<tr><td>${cat}</td><td>${categories[cat]}</td></tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('category-stats').innerHTML = html;
        }

        // ÂÖ®‰Ωì„É™„Çπ„ÉàË°®Á§∫
        function displayOverallList() {
            if (allData.length === 0) {
                document.getElementById('overall-list').innerHTML = '<div class="no-data">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            let html = '<table><thead><tr><th>Â≠¶Ê†°Âêç</th><th>Á®ÆÁõÆ</th><th>ÈÅ∏ÊâãÂêç</th><th>Â≠¶Âπ¥</th><th>Á®ÆÂà•</th></tr></thead><tbody>';
            allData.forEach(entry => {
                const playerInfo = entry.isSingles 
                    ? `${entry.player1Name}`
                    : `${entry.player1Name} / ${entry.player2Name}`;
                const gradeInfo = entry.isSingles
                    ? entry.player1Grade
                    : `${entry.player1Grade} / ${entry.player2Grade}`;
                const typeLabel = entry.isSingles ? '„Ç∑„É≥„Ç∞„É´„Çπ' : '„ÉÄ„Éñ„É´„Çπ';

                html += `<tr>
                    <td>${entry.schoolName}</td>
                    <td>${entry.category}</td>
                    <td>${playerInfo}</td>
                    <td>${gradeInfo}</td>
                    <td>${typeLabel}</td>
                </tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('overall-list').innerHTML = html;
        }

        // Â≠¶Ê†°Âà•ÈõÜË®àË°®Á§∫
        function displaySchoolStats() {
            const schools = {};
            allData.forEach(entry => {
                if (!schools[entry.schoolName]) {
                    schools[entry.schoolName] = 0;
                }
                schools[entry.schoolName]++;
            });

            let html = '<table><thead><tr><th>Â≠¶Ê†°Âêç</th><th>„Ç®„É≥„Éà„É™„ÉºÊï∞</th></tr></thead><tbody>';
            Object.keys(schools).sort().forEach(school => {
                html += `<tr><td>${school}</td><td>${schools[school]}</td></tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('school-stats').innerHTML = html;
        }

        // ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('admin-login-section').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                loadDeletedData();
            } else {
                showAlert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô', 'error');
            }
        }

        // ÂâäÈô§Ê∏à„Åø„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadDeletedData() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getDeletedData');
                const result = await response.json();

                if (result.success) {
                    deletedData = result.data;
                    displayDeletedList();
                } else {
                    document.getElementById('deleted-list').innerHTML = '<div class="no-data">ÂâäÈô§Ê∏à„Åø„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                }
            } catch (error) {
                document.getElementById('deleted-list').innerHTML = '<div class="no-data">„Ç®„É©„Éº: ' + error + '</div>';
            }
        }

        // ÂâäÈô§Ê∏à„Åø„É™„Çπ„ÉàË°®Á§∫
        function displayDeletedList() {
            if (deletedData.length === 0) {
                document.getElementById('deleted-list').innerHTML = '<div class="no-data">ÂâäÈô§Ê∏à„Åø„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            let html = '<table><thead><tr><th>Â≠¶Ê†°Âêç</th><th>Á®ÆÁõÆ</th><th>ÈÅ∏ÊâãÂêç</th><th>Â≠¶Âπ¥</th><th>Êìç‰Ωú</th></tr></thead><tbody>';
            deletedData.forEach(entry => {
                const playerInfo = entry.isSingles 
                    ? `${entry.player1Name}`
                    : `${entry.player1Name} / ${entry.player2Name}`;
                const gradeInfo = entry.isSingles
                    ? entry.player1Grade
                    : `${entry.player1Grade} / ${entry.player2Grade}`;

                html += `<tr>
                    <td>${entry.schoolName}</td>
                    <td>${entry.category}</td>
                    <td>${playerInfo}</td>
                    <td>${gradeInfo}</td>
                    <td>
                        <button class="btn btn-success" onclick='restoreEntry(${JSON.stringify(entry)})'>‚Ü©Ô∏è ÂÖÉ„Å´Êàª„Åô</button>
                        <button class="btn btn-warning" onclick='permanentDelete(${JSON.stringify(entry)})'>üóëÔ∏è ÂÆåÂÖ®„Å´ÂâäÈô§</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('deleted-list').innerHTML = html;
        }

        // ÊúâÂäπ„Ç®„É≥„Éà„É™„ÉºË°®Á§∫
        async function showActiveEntries() {
            const section = document.getElementById('active-entries-section');
            section.style.display = 'block';
            
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData');
                const result = await response.json();

                if (result.success) {
                    allData = result.data;
                    displayActiveList();
                } else {
                    document.getElementById('active-list').innerHTML = '<div class="no-data">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                }
            } catch (error) {
                document.getElementById('active-list').innerHTML = '<div class="no-data">„Ç®„É©„Éº: ' + error + '</div>';
            }
        }

        // ÊúâÂäπ„É™„Çπ„ÉàË°®Á§∫
        function displayActiveList() {
            if (allData.length === 0) {
                document.getElementById('active-list').innerHTML = '<div class="no-data">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            let html = '<table><thead><tr><th>Â≠¶Ê†°Âêç</th><th>Á®ÆÁõÆ</th><th>ÈÅ∏ÊâãÂêç</th><th>Â≠¶Âπ¥</th><th>Êìç‰Ωú</th></tr></thead><tbody>';
            allData.forEach(entry => {
                const playerInfo = entry.isSingles 
                    ? `${entry.player1Name}`
                    : `${entry.player1Name} / ${entry.player2Name}`;
                const gradeInfo = entry.isSingles
                    ? entry.player1Grade
                    : `${entry.player1Grade} / ${entry.player2Grade}`;

                html += `<tr>
                    <td>${entry.schoolName}</td>
                    <td>${entry.category}</td>
                    <td>${playerInfo}</td>
                    <td>${gradeInfo}</td>
                    <td>
                        <button class="btn btn-danger" onclick='deleteEntry(${JSON.stringify(entry)})'>üóëÔ∏è ÂâäÈô§</button>
                    </td>
                </tr>`;
            });
            html += '</tbody></table>';

            document.getElementById('active-list').innerHTML = html;
        }

        // „Ç®„É≥„Éà„É™„ÉºÂâäÈô§ÔºàË´ñÁêÜÂâäÈô§Ôºâ
        async function deleteEntry(entry) {
            if (!confirm(`Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n\nÂ≠¶Ê†°Âêç: ${entry.schoolName}\nÁ®ÆÁõÆ: ${entry.category}\nÈÅ∏Êâã: ${entry.player1Name}`)) {
                return;
            }

            const formData = new FormData();
            formData.append('action', 'deleteEntry');
            formData.append('timestamp', entry.timestamp);
            formData.append('schoolName', entry.schoolName);
            formData.append('category', entry.category);
            formData.append('player1Name', entry.player1Name);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('ÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
                    showActiveEntries();
                    loadDeletedData();
                } else {
                    showAlert('ÂâäÈô§„Ç®„É©„Éº: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('ÂâäÈô§„Ç®„É©„Éº: ' + error, 'error');
            }
        }

        // „Ç®„É≥„Éà„É™„ÉºÂæ©ÂÖÉ
        async function restoreEntry(entry) {
            const formData = new FormData();
            formData.append('action', 'restoreEntry');
            formData.append('timestamp', entry.timestamp);
            formData.append('schoolName', entry.schoolName);
            formData.append('category', entry.category);
            formData.append('player1Name', entry.player1Name);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('Âæ©ÂÖÉ„Åó„Åæ„Åó„Åü', 'success');
                    loadDeletedData();
                    loadStats();
                } else {
                    showAlert('Âæ©ÂÖÉ„Ç®„É©„Éº: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Âæ©ÂÖÉ„Ç®„É©„Éº: ' + error, 'error');
            }
        }

        // ÂÆåÂÖ®ÂâäÈô§
        async function permanentDelete(entry) {
            if (!confirm(`ÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ\n\nÂ≠¶Ê†°Âêç: ${entry.schoolName}\nÁ®ÆÁõÆ: ${entry.category}\nÈÅ∏Êâã: ${entry.player1Name}`)) {
                return;
            }

            const formData = new FormData();
            formData.append('action', 'permanentDelete');
            formData.append('timestamp', entry.timestamp);
            formData.append('schoolName', entry.schoolName);
            formData.append('category', entry.category);
            formData.append('player1Name', entry.player1Name);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.success) {
                    showAlert('ÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
                    loadDeletedData();
                } else {
                    showAlert('ÂÆåÂÖ®ÂâäÈô§„Ç®„É©„Éº: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('ÂÆåÂÖ®ÂâäÈô§„Ç®„É©„Éº: ' + error, 'error');
            }
        }

        // „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÔºà‰ªÆÂÆüË£ÖÔºâ
        function exportData() {
            showAlert('„Åì„ÅÆÊ©üËÉΩ„ÅØËøëÊó•ÂÆüË£Ö‰∫àÂÆö„Åß„Åô', 'info');
        }

        // „Ç¢„É©„Éº„ÉàË°®Á§∫
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(alertDiv, activeTab.firstChild);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // ÂàùÊúüÂåñ
        window.onload = function() {
            loadStats();
        };
    </script>
</body>
</html>
